<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholars Stack - Premium Marketplace</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../../shared-admin-auth.js"></script>
    <script src="../../shared-logout.js"></script>
    <!-- Razorpay SDK (loaded conditionally) -->
    <script>
        // Load Razorpay SDK only when needed
        function loadRazorpaySDK() {
            return new Promise((resolve, reject) => {
                if (window.Razorpay) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://checkout.razorpay.com/v1/checkout.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
    <!-- Dynamic Payment Gateway Script -->
    <script>
        // Payment Gateway Factory
        class PaymentGatewayFactory {
            constructor() {
                this.gateways = {};
                this.currentGateway = null;
            }

            // Initialize the appropriate gateway based on backend response
            async initializeGateway(gatewayType, orderData) {
                if (gatewayType === 'mock') {
                    this.currentGateway = new MockPaymentGateway();
                } else if (gatewayType === 'razorpay') {
                    this.currentGateway = new RazorpayPaymentGateway();
                } else if (gatewayType === 'phonepe') {
                    this.currentGateway = new PhonePePaymentGateway();
                }
                return this.currentGateway;
            }

            async processPayment(orderData, description) {
                if (!this.currentGateway) {
                    throw new Error('Payment gateway not initialized');
                }
                return await this.currentGateway.processPayment(orderData, description);
            }
        }

        // Mock Payment Gateway Class
        class MockPaymentGateway {
            constructor() {
                this.modal = null;
                this.currentOrder = null;
                this.createModal();
            }

            createModal() {
                // Create modal HTML
                const modalHTML = `
                    <div id="mockPaymentModal" class="mock-payment-modal" style="display: none;">
                        <div class="mock-modal-content">
                            <div class="mock-modal-header">
                                <h3>Mock Payment Gateway</h3>
                                <span class="mock-close">&times;</span>
                            </div>
                            <div class="mock-modal-body">
                                <div class="payment-details">
                                    <h4>Payment Details</h4>
                                    <p><strong>Order ID:</strong> <span id="mockOrderId"></span></p>
                                    <p><strong>Amount:</strong> â‚¹<span id="mockAmount"></span></p>
                                    <p><strong>Description:</strong> <span id="mockDescription"></span></p>
                                </div>
                                <div class="payment-form">
                                    <h4>Enter Payment Details (Mock)</h4>
                                    <div class="form-group">
                                        <label>Card Number:</label>
                                        <input type="text" id="mockCardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Expiry:</label>
                                            <input type="text" id="mockExpiry" placeholder="MM/YY" maxlength="5">
                                        </div>
                                        <div class="form-group">
                                            <label>CVV:</label>
                                            <input type="text" id="mockCvv" placeholder="123" maxlength="3">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Card Holder Name:</label>
                                        <input type="text" id="mockCardHolder" placeholder="John Doe">
                                    </div>
                                </div>
                                <div class="payment-actions">
                                    <button id="mockPaySuccess" class="mock-btn success">Pay Successfully</button>
                                    <button id="mockPayFailure" class="mock-btn failure">Simulate Failure</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add modal styles
                const modalStyles = `
                    <style>
                        .mock-payment-modal {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.8);
                            z-index: 10000;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }

                        .mock-modal-content {
                            background: var(--glass-bg);
                            backdrop-filter: blur(10px);
                            border-radius: 16px;
                            width: 90%;
                            max-width: 500px;
                            max-height: 90vh;
                            overflow-y: auto;
                            border: 2px solid var(--accent-blue);
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
                        }

                        .mock-modal-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 20px;
                            border-bottom: 2px solid var(--accent-blue);
                        }

                        .mock-modal-header h3 {
                            color: var(--light-color);
                            margin: 0;
                            font-size: 24px;
                        }

                        .mock-close {
                            font-size: 28px;
                            color: var(--light-color);
                            cursor: pointer;
                            transition: color 0.3s ease;
                        }

                        .mock-close:hover {
                            color: var(--danger-color);
                        }

                        .mock-modal-body {
                            padding: 20px;
                        }

                        .payment-details {
                            background: rgba(52, 152, 219, 0.1);
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                            border: 1px solid var(--accent-blue);
                        }

                        .payment-details h4 {
                            color: var(--accent-blue);
                            margin: 0 0 10px 0;
                        }

                        .payment-details p {
                            margin: 5px 0;
                            color: var(--light-color);
                        }

                        .payment-form h4 {
                            color: var(--light-color);
                            margin-bottom: 15px;
                        }

                        .form-group {
                            margin-bottom: 15px;
                        }

                        .form-row {
                            display: flex;
                            gap: 10px;
                        }

                        .form-row .form-group {
                            flex: 1;
                        }

                        .form-group label {
                            display: block;
                            color: var(--light-color);
                            margin-bottom: 5px;
                            font-weight: 500;
                        }

                        .form-group input {
                            width: 100%;
                            padding: 10px;
                            background: rgba(26, 37, 47, 0.9);
                            border: 2px solid var(--accent-blue);
                            border-radius: 6px;
                            color: var(--light-color);
                            font-size: 14px;
                        }

                        .form-group input:focus {
                            outline: none;
                            border-color: var(--accent-teal);
                            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.3);
                        }

                        .payment-actions {
                            display: flex;
                            gap: 15px;
                            margin-top: 25px;
                        }

                        .mock-btn {
                            flex: 1;
                            padding: 12px 20px;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            font-size: 16px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        }

                        .mock-btn.success {
                            background: var(--success-color);
                            color: white;
                        }

                        .mock-btn.success:hover {
                            background: #27ae60;
                            transform: translateY(-2px);
                        }

                        .mock-btn.failure {
                            background: var(--danger-color);
                            color: white;
                        }

                        .mock-btn.failure:hover {
                            background: #c0392b;
                            transform: translateY(-2px);
                        }
                    </style>
                `;

                // Add to DOM
                document.head.insertAdjacentHTML('beforeend', modalStyles);
                document.body.insertAdjacentHTML('beforeend', modalHTML);

                this.modal = document.getElementById('mockPaymentModal');
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Close modal
                this.modal.querySelector('.mock-close').addEventListener('click', () => {
                    this.close();
                });

                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.close();
                    }
                });

                // Payment buttons
                document.getElementById('mockPaySuccess').addEventListener('click', () => {
                    this.processPayment(true);
                });

                document.getElementById('mockPayFailure').addEventListener('click', () => {
                    this.processPayment(false);
                });
            }

            open(orderData, description) {
                this.currentOrder = orderData;
                document.getElementById('mockOrderId').textContent = orderData.orderId;
                document.getElementById('mockAmount').textContent = (orderData.amount / 100).toFixed(2);
                document.getElementById('mockDescription').textContent = description;
                this.modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            close() {
                this.modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                this.currentOrder = null;
            }

            async processPayment(success) {
                if (!this.currentOrder) return;

                try {
                    if (success) {
                        // Simulate successful payment
                        const response = await fetch('http://localhost:4000/api/v1/payment/verify', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                order_id: this.currentOrder.order_id,
                                payment_id: `mock_payment_${Date.now()}`,
                                signature: 'mock_signature'
                            })
                        });

                        const result = await response.json();
                        if (result.success) {
                            showNotification('Payment successful! Courses unlocked.', 'success');
                            setTimeout(() => {
                                window.location.href = 'payment.html?payment=success&order_id=' + orderId;
                            }, 2000);
                        } else {
                            showNotification('Payment verification failed', 'danger');
                        }
                    } else {
                        // Simulate failed payment
                        showNotification('Payment failed. Please try again.', 'danger');
                    }
                } catch (error) {
                    console.error('Mock payment error:', error);
                    showNotification('Payment processing failed', 'danger');
                }

                this.close();
            }
        }

        // Razorpay Payment Gateway Class
        class RazorpayPaymentGateway {
            async processPayment(orderData, description) {
                // Load Razorpay SDK if not already loaded
                await loadRazorpaySDK();

                return new Promise((resolve, reject) => {
                    const options = {
                        key: orderData.key,
                        amount: orderData.amount,
                        currency: orderData.currency,
                        order_id: orderData.orderId,
                        name: 'Scholars Stack',
                        description: description,
                        image: '/features/images/logo1.png',
                        handler: function (response) {
                            // Payment successful
                            verifyPayment(response, orderData.order_id).then(resolve).catch(reject);
                        },
                        prefill: {
                            name: userProfile.fullName || userProfile.name || '',
                            email: userProfile.email || '',
                            contact: userProfile.phone || ''
                        },
                        theme: {
                            color: '#2ecc71'
                        },
                        modal: {
                            ondismiss: function() {
                                showNotification('Payment cancelled', 'warning');
                                resolve({ success: false, cancelled: true });
                            }
                        }
                    };

                    const rzp = new Razorpay(options);
                    rzp.open();
                });
            }
        }

        // PhonePe Payment Gateway Class
        class PhonePePaymentGateway {
            async processPayment(orderData, description) {
                // For PhonePe, redirect to payment URL
                if (orderData.paymentUrl) {
                    window.location.href = orderData.paymentUrl;
                    return { success: true, redirect: true };
                } else {
                    throw new Error('PhonePe payment URL not available');
                }
            }
        }

        // Initialize payment gateway factory
        const paymentGatewayFactory = new PaymentGatewayFactory();
    </script>
    <style>
        /* === GLOBAL STYLES === */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap');

        :root {
            --primary-dark: #0f1a2a;
            --primary-blue: #1e3a5f;
            --accent-blue: #3498db;
            --accent-teal: #2ecc71;
            --light-color: #ecf0f1;
            --light-color1: #d6d6d6;
            --dark-color: #2c3e50;
            --glass-bg: rgba(15, 26, 42, 0.85);
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --premium-color: #9b59b6;
            --gold-color: #FFD700;
            --sidebar-width: 280px;
            --header-height: 90px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a1423 0%, var(--primary-dark) 100%);
            color: var(--light-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            font-size: 16px;
        }

        /* Background particles */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(52, 152, 219, 0.2);
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) translateX(0) rotate(0deg); }
            25% { transform: translateY(-20px) translateX(20px) rotate(90deg); }
            50% { transform: translateY(0) translateX(40px) rotate(180deg); }
            75% { transform: translateY(20px) translateX(20px) rotate(270deg); }
            100% { transform: translateY(0) translateX(0) rotate(360deg); }
        }

        /* Header styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            background: transparent;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            padding: 0 25px;
            z-index: 1000;
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.4);
            border-bottom: 2px solid var(--accent-blue);
        }

        .menu-toggle {
            width: 48px;
            height: 48px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-right: 20px;
            transition: all 0.3s ease;
        }

        .menu-toggle span {
            display: block;
            width: 30px;
            height: 4px;
            background: var(--light-color);
            margin: 3px 0;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

 
        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 70px;
            width: auto;
            margin-right: 20px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-text h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--light-color);
        }

        .logo-text span {
            font-size: 16px;
            color: var(--accent-teal);
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 6px 18px;
            border-radius: 30px;
            background: rgba(52, 152, 219, 0.2);
            transition: all 0.3s ease;
        }

        .user-profile:hover {
            background: var(--accent-blue);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            margin-right: 12px;
            border: 2px solid var(--light-color);
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 500;
            font-size: 18px;
        }

        .map-access {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--light-color);
            font-size: 24px;
            transition: all 0.3s ease;
            text-decoration: none;
            z-index: 1002;
        }

        .map-access:hover {
            background: var(--accent-blue);
        }

        /* Sidebar styles */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: calc(-1 * var(--sidebar-width));
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: transparent;
            backdrop-filter: blur(10px);
            z-index: 900;
            transition: all 0.3s ease;
            border-right: 2px solid var(--accent-blue);
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            padding: 20px 0;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-title {
            padding: 18px 20px 8px;
            font-size: 15px;
            color: var(--accent-blue);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            color: var(--light-color);
            text-decoration: none;
            font-size: 15px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(52, 152, 219, 0.2);
            border-left: 3px solid var(--accent-blue);
        }

        .sidebar-menu i {
            font-size: 20px;
            margin-right: 12px;
            width: 22px;
            text-align: center;
            color: var(--accent-blue);
        }

        /* Main content */
        .main-content {
            flex: 1;
            padding: calc(var(--header-height) + 30px) 40px 40px;
            transition: margin-left 0.3s ease;
            margin: 0 auto;
            max-width: 1500px;
        }

        .sidebar.active + .main-content {
            margin-left: var(--sidebar-width);
        }

        .page-title {
            font-size: 40px;
            margin-bottom: 25px;
            color: var(--light-color);
            position: relative;
            padding-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-title i {
            color: var(--accent-teal);
            font-size: 1.2em;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100px;
            height: 5px;
            background: var(--accent-blue);
            border-radius: 3px;
        }

        /* Marketplace Hero Section */
        .marketplace-hero {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.9), rgba(26, 37, 47, 0.9)), 
                        url('https://images.unsplash.com/photo-1497636577773-f1231844b336?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            border-radius: 16px;
            padding: 40px 25px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--accent-blue);
            position: relative;
            overflow: hidden;
        }

        .marketplace-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(155, 89, 182, 0.2), rgba(52, 152, 219, 0.2));
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero-title {
            font-size: 32px;
            margin-bottom: 15px;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero-subtitle {
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto 20px;
            color: var(--light-color);
            line-height: 1.5;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }

        .hero-stat {
            text-align: center;
            min-width: 100px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--gold-color);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 16px;
            color: var(--light-color);
        }

        /* Enhanced Marketplace Controls */
        .marketplace-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--accent-blue);
        }

        .search-container {
            position: relative;
            width: 100%;
        }

        .search-container input {
            width: 100%;
            padding: 14px 18px 14px 50px;
            background: rgba(26, 37, 47, 0.9);
            border: 2px solid var(--accent-blue);
            border-radius: 10px;
            color: var(--light-color);
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.3);
        }

        .search-container i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-blue);
            font-size: 22px;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .filter-btn {
            background: rgba(52, 152, 219, 0.2);
            color: var(--accent-blue);
            border: none;
            padding: 10px 18px;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            white-space: nowrap;
        }

        .filter-btn.active, .filter-btn:hover {
            background: var(--accent-blue);
            color: white;
            transform: translateY(-2px);
        }

        .filter-btn i {
            font-size: 18px;
        }

        /* Course Grid */
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .course-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--accent-blue);
            transition: all 0.4s ease;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.35);
        }

        .course-image {
            height: 200px;
            width: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .premium-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--premium-color);
            color: white;
            padding: 7px 12px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            z-index: 2;
        }

        .course-info {
            padding: 25px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .course-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--light-color);
            line-height: 1.3;
            flex: 1;
            margin-right: 10px;
        }

        .course-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 16px;
            color: var(--gold-color);
            font-weight: 600;
        }

        .course-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: #aaa;
        }

        .course-description {
            color: #ddd;
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 14px;
            flex-grow: 1;
        }

        .course-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .course-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--gold-color);
        }

        .add-to-cart {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .add-to-cart:hover {
            background: #27ae60;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.6);
        }

        /* Cart Icon */
        .cart-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 55px;
            height: 55px;
            background: var(--accent-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
        }

        .cart-icon:hover {
            background: var(--primary-blue);
            transform: translateY(-5px);
        }

        .cart-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--danger-color);
            color: white;
            font-size: 11px;
            font-weight: 600;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Cart Preview */
        .cart-preview {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--accent-blue);
            width: 320px;
            z-index: 1000;
            transform: translateY(150%);
            transition: transform 0.5s ease;
        }

        .cart-preview.active {
            transform: translateY(0);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cart-title {
            font-size: 20px;
            color: var(--light-color);
        }

        .close-cart {
            background: transparent;
            border: none;
            color: var(--light-color);
            font-size: 22px;
            cursor: pointer;
        }

        .cart-items {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            margin-right: 12px;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-title {
            font-size: 14px;
            color: var(--light-color);
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .cart-item-price {
            font-size: 16px;
            color: var(--gold-color);
            font-weight: 600;
        }

        .remove-item {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-item:hover {
            background: var(--danger-color);
            color: white;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-top: 12px;
            border-top: 2px solid var(--accent-blue);
        }

        .cart-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .cart-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }

        .btn-view-cart {
            background: transparent;
            border: 2px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .btn-view-cart:hover {
            background: var(--accent-blue);
            color: white;
            transform: translateY(-2px);
        }

        .btn-checkout {
            background: var(--success-color);
            color: white;
            border: none;
        }

        .btn-checkout:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        /* Course Detail Modal */
        .course-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .course-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--glass-bg);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--accent-blue);
            display: flex;
            flex-direction: column;
            transform: translateY(50px);
            transition: transform 0.5s ease;
        }

        .course-modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            background: rgba(26, 37, 47, 0.9);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--accent-blue);
        }

        .modal-title {
            font-size: 28px;
            color: var(--light-color);
            line-height: 1.3;
        }

        .close-modal {
            background: transparent;
            border: none;
            color: var(--light-color);
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: var(--accent-blue);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .course-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .course-image-large {
            height: 260px;
            border-radius: 14px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.25);
        }

        .course-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .detailed-description {
            line-height: 1.7;
            color: #ddd;
            font-size: 15px;
        }

        .course-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .stat-card {
            background: rgba(52, 152, 219, 0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: #aaa;
        }

        .modules-section {
            background: rgba(26, 37, 47, 0.7);
            border-radius: 14px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .section-title {
            font-size: 22px;
            color: var(--accent-blue);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(52, 152, 219, 0.3);
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
        }

        .module-card {
            background: rgba(44, 62, 80, 0.8);
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        .module-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-blue);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .module-title {
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--light-color);
        }

        .module-topics {
            font-size: 13px;
            color: #aaa;
            line-height: 1.5;
        }

        .modal-footer {
            background: rgba(26, 37, 47, 0.9);
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid var(--accent-blue);
            flex-wrap: wrap;
            gap: 8px;
        }

        .price-container {
            display: flex;
            flex-direction: column;
        }

        .original-price {
            text-decoration: line-through;
            color: #aaa;
            font-size: 18px;
        }

        .discount-price {
            font-size: 32px;
            font-weight: 700;
            color: var(--gold-color);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Enhanced Enroll Now Button */
        .enroll-now {
            background: linear-gradient(135deg, var(--success-color), #27ae60) !important;
            color: white !important;
            border: none !important;
            padding: 14px 28px !important;
            border-radius: 12px !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4) !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            position: relative !important;
            overflow: hidden !important;
        }

        .enroll-now::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .enroll-now:hover::before {
            left: 100%;
        }

        .enroll-now:hover {
            background: linear-gradient(135deg, #27ae60, var(--success-color)) !important;
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.6) !important;
        }

        .enroll-now:active {
            transform: translateY(-1px) !important;
        }

        .enroll-now i {
            font-size: 18px !important;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                max-width: 1000px;
                margin: 0 auto;
            }

            .course-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 25px;
            }
            
            .course-overview {
                grid-template-columns: 1fr;
            }
            
            .course-image-large {
                height: 220px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 240px;
                left: -240px;
            }

            .sidebar.active {
                left: 0;
            }

            .hero-title {
                font-size: 28px;
            }
            
            .hero-subtitle {
                font-size: 16px;
            }
            
            .course-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
            
            .course-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-title {
                font-size: 24px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --header-height: 70px;
                --sidebar-width: 100%;
            }

            .header {
                padding: 0 15px;
            }

            .menu-toggle {
                width: 40px;
                height: 40px;
                margin-right: 10px;
            }

            .menu-toggle span {
                width: 25px;
                height: 3px;
            }

            .logo img {
                height: 60px;
                margin-right: 20px;
            }

            .logo-text h1 {
                font-size: 22px;
            }

            .logo-text span {
                font-size: 14px;
            }

            .user-name {
                display: none;
            }

            .user-profile {
                padding: 5px;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
                margin-right: 0;
            }

            .map-access {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .sidebar {
                top: var(--header-height);
                left: -100%;
                width: var(--sidebar-width);
                height: calc(100vh - var(--header-height));
                transition: left 0.3s ease;
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                padding: calc(var(--header-height) + 20px) 20px 20px;
                margin: 0 auto;
                max-width: 100%;
            }

            .sidebar.active + .main-content {
                margin-left: 0;
            }

            .page-title {
                font-size: 28px;
                margin-bottom: 20px;
            }

            .marketplace-hero {
                padding: 30px 20px;
                border-radius: 14px;
            }

            .hero-title {
                font-size: 24px;
            }

            .hero-subtitle {
                font-size: 16px;
            }

            .hero-stats {
                gap: 15px;
                margin-top: 20px;
            }

            .stat-number {
                font-size: 26px;
            }

            .stat-label {
                font-size: 14px;
            }

            .marketplace-controls {
                padding: 18px;
                border-radius: 12px;
            }

            .filter-btn {
                padding: 8px 14px;
                font-size: 13px;
            }

            .course-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
            }

            .course-image {
                height: 180px;
            }

            .course-title {
                font-size: 20px;
            }

            .course-price {
                font-size: 22px;
            }

            .add-to-cart {
                padding: 10px 16px;
                font-size: 13px;
            }

            .cart-preview {
                width: 280px;
                right: 15px;
                bottom: 15px;
            }

            .cart-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .cart-btn {
                padding: 8px;
                font-size: 13px;
            }

            .remove-item {
                width: 26px;
                height: 26px;
                font-size: 12px;
            }

            .modal-footer {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .modal-actions {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            :root {
                --header-height: 65px;
            }

            .header {
                padding: 0 12px;
            }

            .menu-toggle {
                width: 36px;
                height: 36px;
                margin-right: 8px;
            }

            .menu-toggle span {
                width: 22px;
                height: 2.5px;
            }

            .logo img {
                height: 40px;
                margin-right: 10px;
            }

            .logo-text h1 {
                font-size: 18px;
            }

            .logo-text span {
                font-size: 12px;
            }

            .user-avatar {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .map-access {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .main-content {
                padding: calc(var(--header-height) + 15px) 15px 15px;
                margin: 0 auto;
                max-width: 100%;
            }

            .page-title {
                font-size: 24px;
                padding-bottom: 10px;
            }

            .marketplace-hero {
                padding: 25px 15px;
                border-radius: 12px;
            }

            .hero-title {
                font-size: 22px;
            }

            .hero-subtitle {
                font-size: 15px;
            }

            .stat-number {
                font-size: 22px;
            }

            .stat-label {
                font-size: 13px;
            }

            .course-grid {
                grid-template-columns: 1fr;
                gap: 18px;
            }

            .course-info {
                padding: 20px;
            }

            .course-title {
                font-size: 18px;
            }

            .modal-content {
                width: 95%;
                max-height: 85vh;
            }

            .modal-header {
                padding: 15px;
            }

            .modal-title {
                font-size: 20px;
            }

            .modal-body {
                padding: 18px;
                gap: 18px;
            }

            .course-image-large {
                height: 180px;
            }

            .detailed-description {
                font-size: 14px;
            }

            .course-stats {
                grid-template-columns: 1fr 1fr;
            }

            .section-title {
                font-size: 20px;
            }

            .modules-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 22px;
            }

            .hero-title {
                font-size: 20px;
            }

            .filter-container {
                justify-content: center;
            }

            .filter-btn {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }

            .course-header {
                flex-direction: column;
                gap: 10px;
            }

            .course-footer {
                flex-direction: column;
                align-items: flex-start;
            }

            .add-to-cart {
                width: 100%;
                justify-content: center;
            }

            .cart-preview {
                width: calc(100% - 30px);
                max-width: 400px;
                left: 50%;
                transform: translate(-50%, 150%);
            }

            .cart-preview.active {
                transform: translate(-50%, 0);
            }
        }

        @media (max-width: 400px) {
            .logo-text h1 {
                font-size: 16px;
            }

            .logo-text span {
                font-size: 10px;
            }

            .page-title {
                font-size: 20px;
            }

            .hero-title {
                font-size: 18px;
            }

            .hero-subtitle {
                font-size: 14px;
            }

            .map-access {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-particles" id="bgParticles"></div>
    
    <!-- Header with Menu Toggle -->
    <header class="header">
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <div class="logo">
            <a href="/" style="text-decoration: none; display: flex; align-items: center;">
                <img src="/features/images/logo1.png" alt="Scholars Stack Logo">
                <div class="logo-text">
                    <h1>Scholars Stack</h1>
                    <span>Premium Academic Resources</span>
                </div>
            </a>
        </div>
        
        <div class="header-actions">
            <div class="user-profile">
                <div class="user-avatar">
                    <img src="" alt="Profile Photo" id="userAvatar" style="display: none;">
                    <span>S</span>
                </div>
                <div class="user-name">Student</div>
            </div>
            <a href="#" class="map-access" title="Campus Map" aria-label="View Campus Map">
                <i class='bx bxs-map'></i>
            </a>
        </div>
    </header>
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-title">Main Navigation</div>
        <ul class="sidebar-menu">
            <li><a href="../profile/profile.html"><i class='bx bxs-user'></i> Profile</a></li>
            <li><a href="../attendance/attendance.html"><i class='bx bxs-calculator'></i> Attendance Calculator</a></li>
            <li><a href="../gpa-calculator/cgpa.html"><i class='bx bxs-calculator'></i> CGPA Calculator</a></li>
            <li><a href="../ttmaker/ttmaker1.html"><i class='bx bxs-calendar'></i> Timetable Maker</a></li>
        </ul>
        
        <div class="sidebar-title">Resources</div>
        <ul class="sidebar-menu">
            <li><a href="../marketplace/market.html" class="active"><i class='bx bxs-store'></i> Marketplace</a></li>
            <li><a href="#"><i class='bx bxs-group'></i> Club Info</a></li>
            <li><a href="../faculty/faculty.html"><i class='bx bxs-group'></i> Faculty Info</a></li>
            <li><a href="../mess-menu/mess.html"><i class='bx bxs-food-menu'></i> Mess Menus</a></li>
        </ul>
        
        <div class="sidebar-title">Quick Links</div>
        <ul class="sidebar-menu">
            <li><a href="../mycourses/mycourses.html"><i class='bx bxs-graduation'></i> My Courses</a></li>
            <li><a href="../event/event.html"><i class='bx bxs-calendar-event'></i> Events</a></li>
        </ul>
        
        <div class="sidebar-title">Account</div>
        <ul class="sidebar-menu">
            <!-- <li><a href="#"><i class='bx bxs-cog'></i> Settings</a></li> -->
            <li><a href="#" class="logout-link"><i class='bx bxs-log-out'></i> Logout</a></li>
        </ul>
    </nav>
    
    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        <h1 class="page-title">
            <i class='bx bxs-store'></i> Premium Marketplace
        </h1>
        
        <!-- Marketplace Hero Section -->
        <section class="marketplace-hero">
            <div class="hero-content">
                <h2 class="hero-title">Elevate Your Academic Journey</h2>
                <p class="hero-subtitle">Access premium course notes curated by top performers and professors. Invest in your success with Scholars Stack' exclusive marketplace.</p>
                
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="stat-number">20+</div>
                        <div class="stat-label">Premium Courses</div>
                    </div>
                    <div class="hero-stat">
                        <div class="stat-number">4.8â˜…</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="hero-stat">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Satisfied Students</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Enhanced Marketplace Controls -->
        <div class="marketplace-controls">
            <div class="search-container">
                <i class='bx bx-search'></i>
                <input type="text" placeholder="Search courses, subjects, or professors..." id="searchInput">
            </div>
            
            <div class="filter-container">
                <button class="filter-btn active" data-filter="all">
                    <i class='bx bx-filter'></i> All Courses
                </button>
                <button class="filter-btn" data-filter="cs">
                    <i class='bx bx-chip'></i> CS
                </button>
                <button class="filter-btn" data-filter="eng">
                    <i class='bx bx-atom'></i> Engineering
                </button>
                <button class="filter-btn" data-filter="math">
                    <i class='bx bx-calculator'></i> Math
                </button>
                <button class="filter-btn" data-filter="sci">
                    <i class='bx bx-dna'></i> Sciences
                </button>
            </div>
        </div>
        
        <!-- Course Grid -->
        <div class="course-grid">
            <!-- Course 1 -->
            <div class="course-card" data-course="1" data-tags="cs">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1550439062-609e1531270e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Data Structures & Algorithms</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.9</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>12 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>40+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>200+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Master essential data structures and algorithms with comprehensive notes, solved problems, and exam strategies.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,299</div>
                        <button class="add-to-cart" data-id="1" data-title="Data Structures & Algorithms" data-price="1299" data-image="https://images.unsplash.com/photo-1550439062-609e1531270e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 2 -->
            <div class="course-card" data-course="2" data-tags="cs">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Database Management Systems</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.8</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>10 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>35+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>180+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Comprehensive DBMS notes covering SQL, normalization, transactions, and advanced database concepts.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,199</div>
                        <button class="add-to-cart" data-id="2" data-title="Database Management Systems" data-price="1199" data-image="https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 3 -->
            <div class="course-card" data-course="3" data-tags="cs sci">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1581094794329-16d1f0d22b6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Machine Learning Fundamentals</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.9</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>15 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>50+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>250+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        From basics to advanced algorithms. Includes Python implementations, case studies, and exam notes.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,499</div>
                        <button class="add-to-cart" data-id="3" data-title="Machine Learning Fundamentals" data-price="1499" data-image="https://images.unsplash.com/photo-1581094794329-16d1f0d22b6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 4 -->
            <div class="course-card" data-course="4" data-tags="cs eng">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1509228468518-180dd4864904?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Operating Systems</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.7</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>14 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>45+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>220+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Comprehensive notes on processes, threads, memory management, file systems, and security.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,099</div>
                        <button class="add-to-cart" data-id="4" data-title="Operating Systems" data-price="1099" data-image="https://images.unsplash.com/photo-1509228468518-180dd4864904?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 5 -->
            <div class="course-card" data-course="5" data-tags="cs eng">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1596495577886-d920f1fb7238?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Computer Networks</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.8</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>11 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>38+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>190+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Complete notes covering OSI model, TCP/IP, routing, switching, and network security.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,149</div>
                        <button class="add-to-cart" data-id="5" data-title="Computer Networks" data-price="1149" data-image="https://images.unsplash.com/photo-1596495577886-d920f1fb7238?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 6 -->
            <div class="course-card" data-course="6" data-tags="cs">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1461749280684-dccba630e2f6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Web Development</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.9</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>16 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>60+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>280+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Full-stack web development notes covering HTML, CSS, JavaScript, React, Node.js and more.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,399</div>
                        <button class="add-to-cart" data-id="6" data-title="Web Development" data-price="1399" data-image="https://images.unsplash.com/photo-1461749280684-dccba630e2f6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 7 -->
            <div class="course-card" data-course="7" data-tags="math">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Advanced Calculus</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.6</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>8 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>30+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>150+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Master complex calculus concepts with step-by-step solutions and practical applications.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹999</div>
                        <button class="add-to-cart" data-id="7" data-title="Advanced Calculus" data-price="999" data-image="https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Course 8 -->
            <div class="course-card" data-course="8" data-tags="sci">
                <div class="course-image" style="background-image: url('https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80');">
                    <div class="premium-badge">PREMIUM</div>
                </div>
                <div class="course-info">
                    <div class="course-header">
                        <div>
                            <h3 class="course-title">Organic Chemistry</h3>
                        </div>
                        <div class="course-rating">
                            <i class='bx bxs-star' style="color: var(--gold-color);"></i>
                            <span>4.8</span>
                        </div>
                    </div>
                    
                    <div class="course-meta">
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            <span>9 Modules</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-time'></i>
                            <span>35+ Hours</span>
                        </div>
                        <div class="meta-item">
                            <i class='bx bx-download'></i>
                            <span>180+ Notes</span>
                        </div>
                    </div>
                    
                    <p class="course-description">
                        Comprehensive coverage of organic chemistry principles, reactions, and mechanisms.
                    </p>
                    
                    <div class="course-footer">
                        <div class="course-price">â‚¹1,099</div>
                        <button class="add-to-cart" data-id="8" data-title="Organic Chemistry" data-price="1099" data-image="https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80">
                            <i class='bx bx-cart'></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Course Detail Modal -->
    <div class="course-modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalCourseTitle">Course Title</h2>
                <button class="close-modal" id="closeModal">
                    <i class='bx bx-x'></i>
                </button>
            </div>
            
            <div class="modal-body" id="modalBody">
                <!-- Content will be populated by JavaScript -->
            </div>
            
            <div class="modal-footer">
                <div class="price-container">
                    <div class="original-price">â‚¹1,499</div>
                    <div class="discount-price" id="modalCoursePrice">â‚¹1,299</div>
                </div>
                
                <div class="modal-actions">
                    <button class="add-to-cart" id="modalAddToCart">
                        <i class='bx bx-cart'></i> Add to Cart
                    </button>
                    <button class="enroll-now" id="enrollNow">
                        <i class='bx bxs-graduation'></i> Enroll Now - Secure Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Icon -->
    <div class="cart-icon" id="cartIcon">
        <i class='bx bx-cart'></i>
        <div class="cart-count" id="cartCount">0</div>
    </div>
    
    <!-- Cart Preview -->
    <div class="cart-preview" id="cartPreview">
        <div class="cart-header">
            <h3 class="cart-title">Your Cart</h3>
            <button class="close-cart" id="closeCart">
                <i class='bx bx-x'></i>
            </button>
        </div>
        
        <div class="cart-items" id="cartItems">
            <p>Your cart is empty</p>
        </div>
        
        <div class="cart-total">
            <span>Total:</span>
            <span id="cartTotal">â‚¹0</span>
        </div>
        
        <div class="cart-actions">
            <button class="cart-btn btn-view-cart">View Cart</button>
            <button class="cart-btn btn-checkout" id="checkoutButton">Checkout</button>
        </div>
    </div>

    <script>
        // Background particles (match cgpa)
        function createParticles() {
            const particlesContainer = document.getElementById('bgParticles');
            const particleCount = 20;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const size = Math.random() * 60 + 20;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 10}s`;
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize user profile
        let userProfile = { name: '', email: '', phone: '', fullName: '', registrationNumber: '', branch: '', year: '' };

        function isProfileComplete() {
            return userProfile.name && userProfile.email && userProfile.phone;
        }

        // Course data
        const courses = {
            1: {
                id: "1",
                title: "Data Structures & Algorithms",
                image: "https://images.unsplash.com/photo-1550439062-609e1531270e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,299",
                rating: 4.9,
                modules: 12,
                hours: 40,
                notes: 200,
                description: "This comprehensive course covers all essential data structures and algorithms with detailed notes, solved problems, and exam strategies. Designed specifically for VITB students, it includes PYQs from the last 5 years with detailed solutions.",
                modulesList: [
                    { title: "Introduction to Data Structures", topics: "Arrays, Linked Lists, Stacks, Queues, Time Complexity Analysis" },
                    { title: "Trees and Graphs", topics: "Binary Trees, BST, AVL Trees, Graph Representation, BFS, DFS" },
                    { title: "Sorting Algorithms", topics: "Bubble Sort, Selection Sort, Insertion Sort, Merge Sort, Quick Sort" },
                    { title: "Searching Algorithms", topics: "Linear Search, Binary Search, Hashing, Collision Resolution" },
                    { title: "Dynamic Programming", topics: "Memoization, Tabulation, LCS, Knapsack, Matrix Chain Multiplication" },
                    { title: "Greedy Algorithms", topics: "Activity Selection, Huffman Coding, Dijkstra's Algorithm" }
                ],

            },
            2: {
                id: "2",
                title: "Database Management Systems",
                image: "https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,199",
                rating: 4.8,
                modules: 10,
                hours: 35,
                notes: 180,
                description: "Master database concepts with this comprehensive course covering SQL, normalization, transactions, and advanced database concepts. Includes detailed notes and PYQs with solutions.",
                modulesList: [
                    { title: "Database Fundamentals", topics: "Introduction, ER Model, Relational Model" },
                    { title: "SQL Queries", topics: "DDL, DML, Joins, Subqueries, Views" },
                    { title: "Normalization", topics: "1NF, 2NF, 3NF, BCNF, 4NF, 5NF" },
                    { title: "Transaction Management", topics: "ACID Properties, Concurrency Control, Locking" },
                    { title: "Indexing and Optimization", topics: "B+ Trees, Hashing, Query Optimization" }
                ],

            },
            3: {
                id: "3",
                title: "Machine Learning Fundamentals",
                image: "https://images.unsplash.com/photo-1581094794329-16d1f0d22b6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,499",
                rating: 4.9,
                modules: 15,
                hours: 50,
                notes: 250,
                description: "From basics to advanced algorithms, this course includes Python implementations, case studies, and exam notes.",
                modulesList: [
                    { title: "Introduction to ML", topics: "Types of Learning, Applications, Python Setup" },
                    { title: "Linear Regression", topics: "Simple & Multiple Regression, Gradient Descent" },
                    { title: "Classification Algorithms", topics: "Logistic Regression, Decision Trees, SVM" },
                    { title: "Clustering", topics: "K-Means, Hierarchical, DBSCAN" },
                    { title: "Neural Networks", topics: "Perceptrons, Backpropagation, Deep Learning" },
                    { title: "Model Evaluation", topics: "Cross-Validation, Metrics, Hyperparameter Tuning" }
                ],

            },
            4: {
                id: "4",
                title: "Operating Systems",
                image: "https://images.unsplash.com/photo-1509228468518-180dd4864904?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,099",
                rating: 4.7,
                modules: 14,
                hours: 45,
                notes: 220,
                description: "Comprehensive notes on processes, threads, memory management, file systems, and security.",
                modulesList: [
                    { title: "OS Basics", topics: "Structure, Processes, Threads" },
                    { title: "Memory Management", topics: "Paging, Segmentation, Virtual Memory" }
                ],
 
            },
            5: {
                id: "5",
                title: "Computer Networks",
                image: "https://images.unsplash.com/photo-1596495577886-d920f1fb7238?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,149",
                rating: 4.8,
                modules: 11,
                hours: 38,
                notes: 190,
                description: "Complete notes covering OSI model, TCP/IP, routing, switching, and network security.",
                modulesList: [
                    { title: "Network Fundamentals", topics: "OSI, TCP/IP, LAN, WAN" },
                    { title: "Routing", topics: "RIP, OSPF, BGP" }
                ],

            },
            6: {
                id: "6",
                title: "Web Development",
                image: "https://images.unsplash.com/photo-1461749280684-dccba630e2f6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,399",
                rating: 4.9,
                modules: 16,
                hours: 60,
                notes: 280,
                description: "Full-stack web development notes covering HTML, CSS, JavaScript, React, Node.js and more.",
                modulesList: [
                    { title: "Frontend Basics", topics: "HTML, CSS, JavaScript" },
                    { title: "Backend Development", topics: "Node.js, Express" }
                ],

            },
            7: {
                id: "7",
                title: "Advanced Calculus",
                image: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹999",
                rating: 4.6,
                modules: 8,
                hours: 30,
                notes: 150,
                description: "Master complex calculus concepts with step-by-step solutions and practical applications.",
                modulesList: [
                    { title: "Limits and Continuity", topics: "Limits, Continuity, Intermediate Value Theorem" },
                    { title: "Differentiation", topics: "Derivatives, Chain Rule, Implicit Differentiation" },
                    { title: "Integration", topics: "Definite and Indefinite Integrals, Techniques of Integration" }
                ]

            },
            8: {
                id: "8",
                title: "Organic Chemistry",
                image: "https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                price: "â‚¹1,099",
                rating: 4.8,
                modules: 9,
                hours: 35,
                notes: 180,
                description: "Comprehensive coverage of organic chemistry principles, reactions, and mechanisms.",
                modulesList: [
                    { title: "Basic Concepts", topics: "Structure, Bonding, Isomerism" },
                    { title: "Hydrocarbons", topics: "Alkanes, Alkenes, Alkynes, Aromatic Compounds" },
                    { title: "Functional Groups", topics: "Alcohols, Phenols, Ethers, Carboxylic Acids" }
                ],

            }
        };

        // Cart functionality
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let selectedCourse = null;
        let activeFilter = "all";

        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartTotal = document.getElementById('cartTotal');
            cartItems.innerHTML = '';
            let total = 0;
            let itemCount = 0;

            cart.forEach(item => {
                itemCount += item.quantity;
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image" style="background-image: url('${item.image}')"></div>
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.title}</div>
                        <div class="cart-item-price">â‚¹${item.price} Ã— ${item.quantity}</div>
                    </div>
                    <button class="remove-item" data-id="${item.id}">
                        <i class='bx bx-trash'></i>
                    </button>
                `;
                cartItems.appendChild(cartItem);
            });

            cartCount.textContent = itemCount;
            cartTotal.textContent = `â‚¹${total}`;
            if (cart.length === 0) {
                cartItems.innerHTML = '<p>Your cart is empty</p>';
            }

            // Save cart to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));

            // Add remove item listeners
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', () => {
                    const id = button.dataset.id;
                    cart = cart.filter(item => item.id !== id);
                    updateCart();
                });
            });
        }

        // Toggle sidebar
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        
        // Match cgpa/faculty behavior: no overlay, click-outside to close
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });
        document.addEventListener('click', (e) => {
            if (sidebar.classList.contains('active') && 
                !sidebar.contains(e.target) && 
                !menuToggle.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });

        // Sidebar link active state and close on mobile after navigation
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', (e) => {
                // Skip logout links - handled by shared-logout.js
                if (link.classList.contains('logout-link')) {
                    return;
                }

                document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                if (window.matchMedia('(max-width: 768px)').matches) {
                    sidebar.classList.remove('active');
                }
            });
        });

        // Modal and cart elements
        const courseModal = document.getElementById('courseModal');
        const closeModal = document.getElementById('closeModal');
        const modalCourseTitle = document.getElementById('modalCourseTitle');
        const modalCoursePrice = document.getElementById('modalCoursePrice');
        const modalBody = document.getElementById('modalBody');
        const courseCards = document.querySelectorAll('.course-card');
        const modalAddToCart = document.getElementById('modalAddToCart');
        const enrollNowButton = document.getElementById('enrollNow');
        const cartIcon = document.getElementById('cartIcon');
        const cartPreview = document.getElementById('cartPreview');
        const closeCart = document.getElementById('closeCart');
        const checkoutButton = document.getElementById('checkoutButton');

        // Open modal
        courseCards.forEach(card => {
            card.addEventListener('click', (e) => {
                // Prevent modal opening if clicking on add to cart button
                if (e.target.closest('.add-to-cart')) return;

                const courseId = card.dataset.course;
                selectedCourse = courses[courseId];
                if (selectedCourse) {
                    modalCourseTitle.textContent = selectedCourse.title;
                    modalCoursePrice.textContent = selectedCourse.price;
                    modalBody.innerHTML = `
                        <div class="course-overview">
                            <div class="course-image-large" style="background-image: url('${selectedCourse.image}')"></div>
                            <div class="course-details">

                                <p class="detailed-description">${selectedCourse.description}</p>
                                <div class="course-stats">
                                    <div class="stat-card">
                                        <div class="stat-value">${selectedCourse.rating}â˜…</div>
                                        <div class="stat-label">Rating</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value">${selectedCourse.modules}</div>
                                        <div class="stat-label">Modules</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value">${selectedCourse.hours}+</div>
                                        <div class="stat-label">Hours</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value">${selectedCourse.notes}+</div>
                                        <div class="stat-label">Notes</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modules-section">
                            <h3 class="section-title">Course Modules</h3>
                            <div class="modules-grid">
                                ${selectedCourse.modulesList.map(module => `
                                    <div class="module-card">
                                        <h4 class="module-title">${module.title}</h4>
                                        <p class="module-topics">${module.topics}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                    `;
                    courseModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            });
        });

        // Close modal
        closeModal.addEventListener('click', () => {
            courseModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        });

        courseModal.addEventListener('click', (e) => {
            if (e.target === courseModal) {
                courseModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        // Add to cart from course cards
        const addToCartButtons = document.querySelectorAll('.course-card .add-to-cart');
        addToCartButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const id = button.dataset.id;
                const title = button.dataset.title;
                const price = parseInt(button.dataset.price);
                const image = button.dataset.image;

                console.log('Add to cart clicked:', { id, title, price, image });

                const existingItem = cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ id, title, price, image, quantity: 1 });
                }

                updateCart();
                button.innerHTML = '<i class="bx bx-check"></i> Added!';
                button.style.background = 'var(--success-color)';

                setTimeout(() => {
                    button.innerHTML = '<i class="bx bx-cart"></i> Add to Cart';
                    button.style.background = '';
                }, 2000);
            });
        });

        // Add to cart from modal
        modalAddToCart.addEventListener('click', () => {
            if (selectedCourse) {
                const id = selectedCourse.id;
                const title = selectedCourse.title;
                const price = parseInt(selectedCourse.price.replace('â‚¹', '').replace(',', ''));
                const image = selectedCourse.image;

                console.log('Modal add to cart clicked:', { id, title, price, image });

                const existingItem = cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ id, title, price, image, quantity: 1 });
                }

                updateCart();
                showNotification('Course added to cart!', 'success');
                courseModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });


        // Cart toggle
        cartIcon.addEventListener('click', () => {
            cartPreview.classList.toggle('active');
        });

        closeCart.addEventListener('click', () => {
            cartPreview.classList.remove('active');
        });

        // Close cart when clicking outside
        document.addEventListener('click', (e) => {
            if (!cartIcon.contains(e.target) && !cartPreview.contains(e.target)) {
                cartPreview.classList.remove('active');
            }
        });


        // Filter functionality
        const filterButtons = document.querySelectorAll('.filter-btn');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Update active state
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Filter courses
                activeFilter = button.dataset.filter;
                filterCourses();
            });
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', filterCourses);

        // Filter and search function
        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            courseCards.forEach(card => {
                const title = card.querySelector('.course-title').textContent.toLowerCase();
                const description = card.querySelector('.course-description').textContent.toLowerCase();
                const tags = card.dataset.tags;
                
                // Check if matches filter
                const matchesFilter = activeFilter === "all" || tags.includes(activeFilter);
                
                // Check if matches search
                const matchesSearch = title.includes(searchTerm) || 
                                     description.includes(searchTerm);
                
                // Show/hide based on both conditions
                card.style.display = (matchesFilter && matchesSearch) ? 'block' : 'none';
            });
        }
// Dynamic payment handler
async function initializePayment(orderData, courseTitle) {
  try {
    // Initialize the appropriate gateway based on backend response
    const gateway = await paymentGatewayFactory.initializeGateway(orderData.gateway, orderData);

    // Handle PhonePe redirect
    if (orderData.gateway === 'phonepe' && orderData.paymentUrl) {
      window.location.href = orderData.paymentUrl;
      return;
    }

    // Process payment with the selected gateway
    await gateway.processPayment(orderData, courseTitle);
  } catch (error) {
    console.error('Payment initialization error:', error);
    showNotification('Payment initialization failed', 'danger');
  }
}

// Verify payment with backend
async function verifyPayment(razorpayResponse, orderId) {
  try {
    const response = await fetch('http://localhost:4000/api/v1/payment/verify', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify({
        order_id: orderId,
        payment_id: razorpayResponse.razorpay_payment_id,
        signature: razorpayResponse.razorpay_signature
      })
    });

    const result = await response.json();
    if (result.success) {
      showNotification('Payment successful! Access granted to your course.', 'success');
      // Redirect to success page or refresh
      setTimeout(() => {
        window.location.href = '/features/marketplace/payment.html?payment=success&order_id=' + orderId;
      }, 2000);
    } else {
      showNotification('Payment verification failed', 'danger');
    }
  } catch (error) {
    console.error('Verification error:', error);
    showNotification('Payment verification failed', 'danger');
  }
}

// Enroll now - let backend handle all validation
enrollNowButton.addEventListener('click', async () => {
  if (selectedCourse) {
    console.log('Enroll now clicked for course:', selectedCourse.title);

    if (!isAuthenticated()) {
      console.log('User not authenticated, redirecting to login');
      return;
    }

    try {
      const amount = parseInt(selectedCourse.price.replace('â‚¹', '').replace(',', '')) * 100;
      console.log('Creating checkout session with amount:', amount);

      const response = await fetch('http://localhost:4000/api/v1/payment/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: JSON.stringify({
          courseId: selectedCourse.id,
          subject: selectedCourse.title,
          amount: amount
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        console.error('Payment error response:', errorData);

        if (response.status === 401) {
          // Not authenticated - redirect to login
          showNotification('Please log in to proceed with payment.', 'warning');
          setTimeout(() => {
            window.location.href = '/login1.html';
          }, 1000);
          return;
        } else if (response.status === 403) {
          if (errorData.error === 'profile_incomplete') {
            // Profile incomplete - redirect to profile page
            showNotification('Please complete your profile before purchasing courses.', 'warning');
            setTimeout(() => {
              window.location.href = '/features/profile/profile.html';
            }, 1000);
            return;
          } else if (errorData.error === 'not_verified') {
            // Email not verified
            showNotification('Please verify your email before making purchases.', 'warning');
            setTimeout(() => {
              window.location.href = '/verify-email';
            }, 1000);
            return;
          } else {
            // Other 403 errors
            showNotification(errorData.message || 'Access denied.', 'danger');
            return;
          }
        }

        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      console.log('Payment data received:', data);

      if (data.orderId) {
        initializePayment(data, selectedCourse.title);
      } else {
        showNotification('Payment initiation failed: ' + (data.error || 'Unknown error'), 'danger');
      }
    } catch (err) {
      console.error('Payment error:', err);
      showNotification('Payment initiation failed: ' + err.message, 'danger');
    }

    courseModal.classList.remove('active');
    document.body.style.overflow = 'auto';
  }
});

// Checkout - let backend handle all validation
checkoutButton.addEventListener('click', async () => {
  console.log('Checkout button clicked');

  if (cart.length === 0) {
    showNotification('Your cart is empty', 'warning');
    return;
  }

  if (!isAuthenticated()) {
    console.log('User not authenticated for checkout');
    return;
  }

  try {
    const items = cart.map(item => ({
      courseId: item.id,
      subject: item.title,
      amount: item.price * 100 // Convert to paisa
    }));

    console.log('Checkout items:', items);

    const response = await fetch('http://localhost:4000/api/v1/payment/create-checkout-session', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify({ items }),
    });

    if (!response.ok) {
      const errorData = await response.json();
      console.error('Checkout error response:', errorData);

      if (response.status === 401) {
        // Not authenticated - redirect to login
        showNotification('Please log in to proceed with payment.', 'warning');
        setTimeout(() => {
          window.location.href = '/login1.html';
        }, 1000);
        return;
      } else if (response.status === 403) {
        if (errorData.error === 'profile_incomplete') {
          // Profile incomplete - redirect to profile page
          showNotification('Please complete your profile before purchasing courses.', 'warning');
          setTimeout(() => {
            window.location.href = '/features/profile/profile.html';
          }, 1000);
          return;
        } else if (errorData.error === 'not_verified') {
          // Email not verified
          showNotification('Please verify your email before making purchases.', 'warning');
          setTimeout(() => {
            window.location.href = '/verify-email';
          }, 1000);
          return;
        } else {
          // Other 403 errors
          showNotification(errorData.message || 'Access denied.', 'danger');
          return;
        }
      }

      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    console.log('Checkout data received:', data);

    if (data.orderId) {
      const courseTitles = cart.map(item => item.title).join(', ');
      initializePayment(data, `Cart Purchase: ${courseTitles}`);
    } else {
      showNotification('Checkout failed: ' + (data.error || 'Unknown error'), 'danger');
    }
  } catch (err) {
    console.error('Checkout error:', err);
    showNotification('Checkout failed: ' + err.message, 'danger');
  }

  cartPreview.classList.remove('active');
});
const accessBtns = document.querySelectorAll('.access-btn');
accessBtns.forEach(btn => {
  btn.addEventListener('click', async (e) => {
    e.preventDefault();
    const courseId = btn.closest('.course-card').dataset.course;
    
    try {
      const response = await fetch('/api/v1/payment/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}` // Assuming JWT auth
        },
        body: JSON.stringify({ courseId }),
      });
      const data = await response.json();
      window.location.href = data.sessionUrl;
    } catch (err) {
      alert('Payment initiation failed');
    }
  });
});
function isAuthenticated() {
  const token = localStorage.getItem('token');
  if (!token) {
    alert('Please log in to proceed with payment.');
    window.location.href = '/login1.html'; // Correct path to login page
    return false;
  }
  return true;
}


async function fetchUserProfile() {
  try {
    const token = localStorage.getItem('token');
    if (!token) return null;

    const response = await fetch('http://localhost:4000/api/v1/profile/me', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    if (response.ok) {
      const data = await response.json();
      return data.data || data;
    }
    return null;
  } catch (err) {
    console.error('Failed to fetch profile:', err);
    return null;
  }
}

let isUserProfileComplete = false;

// Load user profile on page load
async function loadUserProfile() {
  const profileData = await fetchUserProfile();
  if (profileData) {
      const profile = profileData.user;
      userProfile = {
        name: profile.username || profile.name || '',
        email: profile.email || '',
        phone: profile.phone || '',
        fullName: profile.fullName || '',
        registrationNumber: profile.registrationNumber || '',
        branch: profile.branch || '',
        year: profile.year || ''
      };
      // Use the backend's profile completion status from the response
      isUserProfileComplete = profileData.profileComplete || false;
  }
}

function isProfileComplete() {
  return isUserProfileComplete;
}
        // Handle payment success/failure from URL parameters
        function handlePaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const paymentStatus = urlParams.get('payment');

            if (paymentStatus === 'success') {
                // Clear cart on successful payment
                cart = [];
                localStorage.removeItem('cart'); // Clear from localStorage too
                updateCart();

                // Show success message
                showNotification('Payment successful! You now have access to your courses.', 'success');

                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (paymentStatus === 'cancelled') {
                showNotification('Payment was cancelled. You can try again anytime.', 'warning');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Show notification function (moved to top for availability)
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success-color)' : type === 'warning' ? 'var(--warning-color)' : 'var(--accent-blue)'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                font-weight: 500;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Add CSS for notification animations
        const notificationStyle = document.createElement('style');
        notificationStyle.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(notificationStyle);

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            createParticles();
            await loadUserProfile(); // Load user profile first
            updateCart();
            handlePaymentStatus();
        });
    </script>
</body>
</html>