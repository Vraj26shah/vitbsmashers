<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mess Menu | Scholars Stack</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../../shared-admin-auth.js"></script>
    <script src="../shared-logout.js"></script>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap');

:root {
    --primary-dark: #0f1a2a;
    --primary-blue: #1e3a5f;
    --accent-blue: #3498db;
    --accent-teal: #2ecc71;
    --light-color: #ecf0f1;
    --light-color1: #d6d6d6;
    --dark-color: #2c3e50;
    --glass-bg: rgba(15, 26, 42, 0.85);
    --success-color: #2ecc71;
    --warning-color: #f39c12;
    --danger-color: #e74c3c;
    --premium-color: #9b59b6;
    --boys-color: #3498db;
    --girls-color: #e84393;
    --sidebar-width: 280px;
    --header-height: 90px;
    --closed-color: #e74c3c;
    --active-glow: 0 0 15px rgba(52, 152, 219, 0.8);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    background: linear-gradient(135deg, #0a1423 0%, var(--primary-dark) 100%);
    color: var(--light-color);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    font-size: 16px;
}

/* Background particles */
.bg-particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
}

.particle {
    position: absolute;
    border-radius: 50%;
    background: rgba(52, 152, 219, 0.2);
    animation: float 15s infinite linear;
}

@keyframes float {
    0% { transform: translateY(0) translateX(0) rotate(0deg); }
    25% { transform: translateY(-20px) translateX(20px) rotate(90deg); }
    50% { transform: translateY(0) translateX(40px) rotate(180deg); }
    75% { transform: translateY(20px) translateX(20px) rotate(270deg); }
    100% { transform: translateY(0) translateX(0) rotate(360deg); }
}

/* Header styles */
.header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: var(--header-height);
    background: transparent;
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    padding: 0 25px;
    z-index: 1000;
    box-shadow: 5px 0 30px rgba(0, 0, 0, 0.4);
    border-bottom: 2px solid var(--accent-blue);
}

.menu-toggle {
    width: 48px;
    height: 48px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    margin-right: 20px;
    transition: all 0.3s ease;
}

.menu-toggle span {
    display: block;
    width: 30px;
    height: 4px;
    background: var(--light-color);
    margin: 3px 0;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.logo {
    display: flex;
    align-items: center;
}

.logo img {
    height: 60px;
    width: auto;
    margin-right: 20px;
}

.logo-text {
    display: flex;
    flex-direction: column;
}

.logo-text h1 {
    font-size: 28px;
    font-weight: 700;
    color: var(--light-color);
}

.logo-text span {
    font-size: 16px;
    color: var(--accent-teal);
}

.header-actions {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 20px;
}

.user-profile {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 6px 18px;
    border-radius: 30px;
    background: rgba(52, 152, 219, 0.2);
    transition: all 0.3s ease;
}

.user-profile:hover {
    background: var(--accent-blue);
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--accent-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 20px;
    margin-right: 12px;
    border: 2px solid var(--light-color);
    overflow: hidden;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-name {
    font-weight: 500;
    font-size: 18px;
}

.map-access {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: rgba(52, 152, 219, 0.2);
    color: var(--light-color);
    font-size: 24px;
    transition: all 0.3s ease;
    text-decoration: none;
    z-index: 1002;
}

.map-access:hover {
    background: var(--accent-blue);
}

/* Sidebar styles */
.sidebar {
    position: fixed;
    top: var(--header-height);
    left: calc(-1 * var(--sidebar-width));
    width: var(--sidebar-width);
    height: calc(100vh - var(--header-height));
    background: transparent;
    backdrop-filter: blur(10px);
    z-index: 900;
    transition: all 0.3s ease;
    border-right: 2px solid var(--accent-blue);
    box-shadow: 5px 0 30px rgba(0, 0, 0, 0.4);
    overflow-y: auto;
    padding: 20px 0;
}

.sidebar.active {
    left: 0;
}

.sidebar-title {
    padding: 18px 20px 8px;
    font-size: 15px;
    color: var(--accent-blue);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.sidebar-menu {
    list-style: none;
}

.sidebar-menu li {
    margin-bottom: 5px;
}

.sidebar-menu a {
    display: flex;
    align-items: center;
    padding: 14px 20px;
    color: var(--light-color);
    text-decoration: none;
    font-size: 15px;
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
}

.sidebar-menu a:hover,
.sidebar-menu a.active {
    background: rgba(52, 152, 219, 0.2);
    border-left: 3px solid var(--accent-blue);
}

.sidebar-menu i {
    font-size: 20px;
    margin-right: 12px;
    width: 22px;
    text-align: center;
    color: var(--accent-blue);
}

/* Main content */
.main-content {
    flex: 1;
    padding: calc(var(--header-height) + 30px) 40px 40px;
    transition: margin-left 0.3s ease;
    margin: 0 auto;
    max-width: 1500px;
}

.sidebar.active + .main-content {
    margin-left: var(--sidebar-width);
}

.page-title {
    font-size: 40px;
    margin-bottom: 25px;
    color: var(--light-color);
    position: relative;
    padding-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.page-title i {
    color: var(--accent-teal);
    font-size: 1.2em;
}

.page-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100px;
    height: 5px;
    background: var(--accent-blue);
    border-radius: 3px;
}

/* Mobile overlay */
.mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 800;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.mobile-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* === MESS MENU SYSTEM === */
.main-container {
    position: relative;
    width: 100%;
    padding: 0 15px;
    transition: all 0.3s ease;
    z-index: 2;
}

.live-status-banner {
    background: linear-gradient(135deg, var(--accent-blue), var(--primary-blue));
    border-radius: 12px;
    padding: 15px 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    border: 1px solid rgba(52, 152, 219, 0.3);
}

.live-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    color: white;
    font-weight: 600;
    font-size: 14px;
}

.pulse-dot {
    width: 10px;
    height: 10px;
    background: #fff;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.2); }
    100% { opacity: 1; transform: scale(1); }
}

.last-update {
    color: rgba(255, 255, 255, 0.9);
    font-size: 12px;
}

.meal-countdown {
    display: flex;
    align-items: center;
}

.countdown-info {
    display: flex;
    align-items: center;
    gap: 8px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 12px;
}

#countdown-timer {
    font-weight: bold;
    color: var(--warning-color);
    background: rgba(243, 156, 18, 0.2);
    padding: 2px 8px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
}

/* Search Section */
.search-section {
    background: rgba(44, 62, 80, 0.5);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(52, 152, 219, 0.3);
    margin-bottom: 20px;
    position: relative;
}

.search-header {
    text-align: center;
    margin-bottom: 20px;
}

.search-header h2 {
    font-size: 22px;
    color: var(--accent-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.search-container {
    position: relative;
    max-width: 600px;
    margin: 0 auto;
    z-index: 10000;
}

.search-box {
    position: relative;
    width: 100%;
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--accent-blue);
    font-size: 18px;
}

.search-box input {
    width: 100%;
    padding: 14px 15px 14px 50px;
    background: rgba(44, 62, 80, 0.8);
    border: 2px solid rgba(52, 152, 219, 0.5);
    border-radius: 10px;
    color: var(--light-color);
    font-size: 16px;
    transition: all 0.3s ease;
}

.search-box input:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
}

.search-box input:hover {
    border-color: var(--accent-blue);
}

.search-box input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

.search-box input:hover::placeholder {
    color: rgba(255, 255, 255, 0.9);
}

.search-instruction {
    text-align: center;
    margin-top: 10px;
    padding: 8px;
    background: rgba(52, 152, 219, 0.1);
    border-radius: 8px;
    color: var(--accent-blue);
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border: 1px solid rgba(52, 152, 219, 0.2);
}

.search-instruction i {
    font-size: 14px;
}

.scroll-indicator {
    position: sticky;
    bottom: 0;
    background: rgba(52, 152, 219, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    animation: pulse 2s infinite;
}

.scroll-indicator i {
    margin-right: 8px;
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-5px); }
    60% { transform: translateY(-3px); }
}

.search-recommendations {
    position: absolute;
    width: 100%;
    background: rgba(44, 62, 80, 0.98);
    border-radius: 0 0 12px 12px;
    border: 2px solid rgba(52, 152, 219, 0.5);
    border-top: none;
    max-height: 80vh;
    overflow-y: auto;
    display: none;
    backdrop-filter: blur(15px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 10001;
}

.search-recommendations.show {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

.recommendation-item {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
}

.search-recommendations.show .recommendation-item {
    opacity: 1;
    transform: translateY(0);
    transition-delay: calc(0.1s * var(--index));
}

.category-header {
    background: rgba(52, 152, 219, 0.3);
    padding: 12px 15px;
    font-weight: 600;
    color: var(--accent-blue);
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.category-header.canteen-category {
    background: rgba(155, 89, 182, 0.3);
    color: var(--premium-color);
    border-bottom-color: rgba(155, 89, 182, 0.3);
}

.category-header.night-canteen-category {
    background: rgba(243, 156, 18, 0.3);
    color: var(--warning-color);
    border-bottom-color: rgba(243, 156, 18, 0.3);
}

.category-header.boys-mess {
    background: rgba(52, 152, 219, 0.3);
    color: var(--boys-color);
    border-bottom-color: rgba(52, 152, 219, 0.3);
}

.category-header.girls-mess {
    background: rgba(232, 67, 147, 0.3);
    color: var(--girls-color);
    border-bottom-color: rgba(232, 67, 147, 0.3);
}

.total-results-header {
    background: rgba(46, 204, 113, 0.3);
    padding: 10px 15px;
    font-weight: 600;
    color: var(--success-color);
    font-size: 13px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.recommendation-item.no-results {
    text-align: center;
    padding: 20px;
    color: var(--light-color1);
}

.recommendation-item.no-results i {
    font-size: 20px;
    color: var(--closed-color);
    margin-bottom: 8px;
    display: block;
}

.recommendation-item {
    padding: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.2s ease;
    min-height: 60px;
}

.recommendation-item:hover {
    background: rgba(52, 152, 219, 0.2);
}

.recommendation-item i {
    color: var(--accent-blue);
    font-size: 16px;
    width: 20px;
}

.recommendation-content {
    flex-grow: 1;
}

.recommendation-name {
    font-weight: 500;
    color: var(--light-color);
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.recommendation-location {
    color: var(--light-color1);
    font-size: 11px;
    margin-top: 2px;
}

.type-badge {
    background: rgba(46, 204, 113, 0.2);
    color: var(--success-color);
    padding: 3px 8px;
    border-radius: 15px;
    font-size: 11px;
    font-weight: 500;
}

.status-badge {
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 500;
}

.status-open {
    background: rgba(46, 204, 113, 0.2);
    color: var(--success-color);
}

.status-closed {
    background: rgba(231, 76, 60, 0.2);
    color: var(--closed-color);
}

.status-upcoming {
    background: rgba(243, 156, 18, 0.2);
    color: var(--warning-color);
}

.type-badge.canteen {
    background: rgba(155, 89, 182, 0.2);
    color: var(--premium-color);
}

.type-badge.night-canteen {
    background: rgba(243, 156, 18, 0.2);
    color: var(--warning-color);
}

.type-badge.boys-mess {
    background: rgba(52, 152, 219, 0.2);
    color: var(--boys-color);
}

.type-badge.girls-mess {
    background: rgba(232, 67, 147, 0.2);
    color: var(--girls-color);
}

/* Current Meal Display */
.current-display {
    background: rgba(44, 62, 80, 0.5);
    border-radius: 12px;
    padding: 25px;
    border: 1px solid rgba(52, 152, 219, 0.3);
    margin-bottom: 20px;
    display: none;
    width: 100%;
    text-align: left;
}

.display-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.location-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.location-icon {
    width: 40px;
    height: 40px;
    background: rgba(52, 152, 219, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: var(--accent-blue);
}

.location-text h3 {
    font-size: 20px;
    color: var(--accent-blue);
}

.location-text p {
    color: var(--light-color1);
    font-size: 14px;
}

.view-full-btn {
    background: rgba(52, 152, 219, 0.2);
    border: none;
    color: var(--accent-blue);
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    min-height: 44px;
}

.view-full-btn:hover {
    background: var(--accent-blue);
    color: white;
}

.current-meal-section {
    margin-top: 20px;
}

.section-title {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 15px;
    color: var(--accent-blue);
    font-size: 18px;
}

.meal-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.meal-time {
    font-size: 14px;
    color: var(--accent-teal);
    display: flex;
    align-items: center;
    gap: 6px;
}

.meal-status {
    background: rgba(46, 204, 113, 0.2);
    color: var(--success-color);
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 13px;
    font-weight: 500;
}

.meal-status.closed {
    background: rgba(231, 76, 60, 0.2);
    color: var(--closed-color);
}

.meal-status.upcoming {
    background: rgba(243, 156, 18, 0.2);
    color: var(--warning-color);
}

.meal-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.meal-item {
    background: rgba(52, 152, 219, 0.15);
    padding: 15px;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(52, 152, 219, 0.2);
}

.meal-item.closed {
    background: rgba(231, 76, 60, 0.15);
    color: var(--closed-color);
    grid-column: 1 / -1;
    font-weight: 500;
}

.meal-item.upcoming {
    background: rgba(243, 156, 18, 0.15);
    color: var(--warning-color);
    border-left: 3px solid var(--warning-color);
}

.meal-item:hover {
    transform: translateY(-3px);
    background: rgba(52, 152, 219, 0.25);
    box-shadow: 0 5px 12px rgba(0, 0, 0, 0.2);
    border-color: rgba(52, 152, 219, 0.4);
}

.meal-item.closed:hover {
    background: rgba(231, 76, 60, 0.15);
    transform: none;
}

.meal-item.upcoming:hover {
    background: rgba(243, 156, 18, 0.25);
}

.meal-item-content {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
}

.meal-item-content i {
    color: var(--accent-blue);
    font-size: 14px;
    width: 18px;
    text-align: center;
}

.meal-item-content span {
    flex: 1;
    text-align: left;
}

.meal-item.upcoming-header {
    background: rgba(243, 156, 18, 0.2);
    border: 2px solid var(--warning-color);
    grid-column: 1 / -1;
    margin-bottom: 10px;
}

.upcoming-header-content {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
    font-weight: 600;
    color: var(--warning-color);
}

.upcoming-header-content i {
    font-size: 16px;
}

.meal-item.closed-message {
    background: rgba(231, 76, 60, 0.15);
    border: 2px solid var(--closed-color);
    grid-column: 1 / -1;
    padding: 20px;
}

.closed-message-content {
    display: flex;
    align-items: center;
    gap: 15px;
    justify-content: center;
    text-align: center;
}

.closed-message-content i {
    font-size: 24px;
    color: var(--closed-color);
}

.closed-text h4 {
    color: var(--closed-color);
    margin-bottom: 6px;
    font-size: 16px;
}

.closed-text p {
    color: var(--light-color1);
    font-size: 13px;
    margin: 0;
}

/* Enhanced Canteen Menu Grid Styles */
.canteen-menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    width: 100%;
    margin: 0 auto;
    padding: 0;
    justify-items: stretch;
    align-items: stretch;
    max-width: 1200px;
}

.menu-category {
    background: rgba(30, 58, 95, 0.7);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(52, 152, 219, 0.3);
    transition: all 0.3s ease;
    width: 100%;
    text-align: left;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    box-sizing: border-box;
}

.menu-items {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    flex: 1;
    justify-content: flex-start;
    min-height: 0;
}

.menu-category:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
    border-color: rgba(52, 152, 219, 0.5);
}

.category-title {
    font-size: 18px;
    color: var(--accent-blue);
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--accent-teal);
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

.category-title i {
    font-size: 20px;
}

.menu-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    background: rgba(15, 26, 42, 0.6);
    border-radius: 8px;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.menu-item:hover {
    background: rgba(52, 152, 219, 0.2);
    transform: translateX(3px);
}

.menu-item-name {
    font-size: 15px;
    color: var(--light-color);
}

.menu-item-price {
    font-size: 15px;
    color: var(--accent-teal);
    font-weight: 600;
    background: rgba(46, 204, 113, 0.1);
    padding: 4px 10px;
    border-radius: 15px;
}

.canteen-header {
    display: none;
}

.canteen-header-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    font-weight: 600;
    color: var(--premium-color);
    font-size: 20px;
}

.canteen-header-content i {
    font-size: 24px;
}

/* Full Menu Section */
.full-menu-section {
    background: rgba(44, 62, 80, 0.5);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(52, 152, 219, 0.3);
    margin-top: 20px;
    display: none;
}

.schedule-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.schedule-title {
    font-size: 20px;
    color: var(--accent-blue);
    display: flex;
    align-items: center;
    gap: 8px;
}

.back-button {
    background: var(--accent-blue);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    min-height: 44px;
}

.back-button:hover {
    background: var(--primary-blue);
}

/* Weekly Schedule Table */
.schedule-table-container {
    overflow-x: auto;
    width: 100%;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    margin: 0 auto;
    max-width: 100%; /* Align with main-content */
}

.schedule-table {
    width: 100%;
    max-width: 1200px; /* Reduced to fit within main-content */
    border-collapse: collapse;
    margin: 15px auto; /* Center the table */
    border-radius: 8px;
    overflow: hidden;
    background: rgba(44, 62, 80, 0.3);
}

.schedule-table th,
.schedule-table td {
    padding: 10px 8px; /* Reduced padding for compactness */
    text-align: left; /* Changed to left for better readability */
    border: 1px solid rgba(52, 152, 219, 0.3);
    font-size: 13px; /* Smaller font size */
    line-height: 1.3;
    vertical-align: top; /* Align content to top */
    max-width: 120px; /* Reduced max-width for cells */
    white-space: nowrap; /* Prevent text wrapping */
    overflow: hidden;
    text-overflow: ellipsis; /* Truncate long text */
}

.schedule-table th {
    background: var(--accent-blue);
    color: white;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 10;
    text-transform: uppercase;
    font-size: 12px; /* Smaller header font */
}

.schedule-table td {
    color: var(--light-color);
    background: rgba(44, 62, 80, 0.4);
}

.schedule-table .current-day {
    background: rgba(46, 204, 113, 0.3);
    color: var(--light-color);
    font-weight: 600;
}

.schedule-table .current-meal {
    background: rgba(46, 204, 113, 0.2);
    font-weight: 600;
}

.schedule-table .closed {
    background: rgba(231, 76, 60, 0.2);
    color: var(--closed-color);
}

/* Schedule Grid (Retained as is) */
.schedule-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.day-schedule {
    background: rgba(30, 58, 95, 0.7);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(52, 152, 219, 0.3);
}

.day-header {
    font-size: 18px;
    color: var(--accent-blue);
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--accent-teal);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.day-header.current-day {
    color: var(--accent-teal);
}

.meal-section {
    margin-bottom: 15px;
}

.meal-title {
    font-size: 16px;
    color: var(--light-color);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.meal-title i {
    color: var(--accent-teal);
}

.meal-items {
    background: rgba(15, 26, 42, 0.6);
    border-radius: 8px;
    padding: 12px;
}

.meal-item {
    padding: 6px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 8px;
}

.meal-item:last-child {
    border-bottom: none;
}

.meal-item i {
    color: var(--accent-teal);
    font-size: 12px;
}

.current-meal .meal-title {
    color: var(--accent-teal);
    font-weight: 600;
}

.current-meal .meal-items {
    border: 1px solid var(--accent-teal);
}

/* Quick Filters */
.quick-filters {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.filters-header h4 {
    color: var(--accent-blue);
    margin-bottom: 10px;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.filter-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
}

.filter-btn {
    background: rgba(52, 152, 219, 0.1);
    border: 1px solid rgba(52, 152, 219, 0.3);
    color: var(--accent-blue);
    padding: 6px 12px;
    border-radius: 15px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    min-width: 48px;
    min-height: 48px;
    justify-content: center;
}

.filter-btn:hover,
.filter-btn.active {
    background: var(--accent-blue);
    color: white;
    transform: scale(1.05);
}

/* Responsive Design */
@media (max-width: 1200px) {
    .main-content {
        max-width: 1000px;
        padding: calc(var(--header-height) + 15px) 20px 20px;
        margin: 0 auto;
    }

    .canteen-menu-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        max-width: 100%;
    }

    .page-title {
        font-size: 32px;
    }

    .schedule-table {
        max-width: 900px; /* Adjust for smaller screens */
    }

    .schedule-table th,
    .schedule-table td {
        padding: 8px 6px;
        font-size: 12px;
        max-width: 100px; /* Tighter cells */
    }
}

@media (max-width: 992px) {
    :root {
        --sidebar-width: 240px;
    }

    .header {
        padding: 0 30px;
    }

    .logo img {
        height: 70px;
    }

    .logo-text h1 {
        font-size: 28px;
    }

    .logo-text span {
        font-size: 16px;
    }

    .user-name {
        font-size: 18px;
    }

    .sidebar {
        width: 240px;
        left: -240px;
    }

    .sidebar.active {
        left: 0;
    }

    .main-content {
        padding: calc(var(--header-height) + 15px) 15px 15px;
        max-width: 100%;
    }

    .canteen-menu-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .page-title {
        font-size: 28px;
    }

    .search-header h2 {
        font-size: 20px;
    }

    .location-text h3 {
        font-size: 18px;
    }

    .section-title {
        font-size: 16px;
    }

    .menu-category {
        padding: 15px;
    }

    .category-title {
        font-size: 16px;
    }

    .menu-item-name,
    .menu-item-price {
        font-size: 14px;
    }

    .schedule-table-container {
        margin: 0 -15px;
        padding: 0 15px;
    }

    .schedule-table {
        max-width: 700px; /* Further reduced */
    }

    .schedule-table th,
    .schedule-table td {
        max-width: 80px;
        font-size: 11px;
    }
}

@media (max-width: 768px) {
    :root {
        --header-height: 60px;
        --sidebar-width: 100%;
    }

    .header {
        padding: 0 12px;
    }

    .menu-toggle {
        width: 34px;
        height: 34px;
        margin-right: 10px;
    }

    .menu-toggle span {
        width: 22px;
        height: 2.5px;
        margin: 2px 0;
    }

    .logo img {
        height: 40px;
        margin-right: 10px;
    }

    .logo-text h1 {
        font-size: 18px;
    }

    .logo-text span {
        font-size: 12px;
    }

    .user-name {
        display: none;
    }

    .user-profile {
        padding: 4px;
    }

    .user-avatar {
        width: 34px;
        height: 34px;
        font-size: 14px;
        margin-right: 0;
        border-width: 1px;
    }

    .map-access {
        width: 34px;
        height: 34px;
        font-size: 16px;
    }

    .header-actions {
        gap: 10px;
    }

    .sidebar {
        top: var(--header-height);
        left: -100%;
        width: var(--sidebar-width);
        height: calc(100vh - var(--header-height));
        transition: left 0.3s ease;
    }

    .sidebar.active {
        left: 0;
    }

    .sidebar.active + .main-content {
        margin-left: 0;
    }

    .main-content {
        padding: calc(var(--header-height) + 15px) 15px 20px;
        margin: 0 auto;
        max-width: 100%;
    }

    .page-title {
        font-size: 20px;
        margin-bottom: 15px;
    }

    .live-status-banner {
        flex-direction: column;
        gap: 10px;
        padding: 12px;
        font-size: 13px;
    }

    .live-indicator,
    .last-update,
    .countdown-info {
        font-size: 12px;
        justify-content: center;
    }

    .pulse-dot {
        width: 8px;
        height: 8px;
    }

    #countdown-timer {
        font-size: 12px;
        padding: 2px 6px;
    }

    .search-section,
    .current-display,
    .full-menu-section {
        padding: 15px;
        margin-bottom: 15px;
    }

    .search-header h2 {
        font-size: 18px;
    }

    .search-box input {
        padding: 12px 12px 12px 45px;
        font-size: 15px;
        min-height: 48px;
    }

    .search-box i {
        left: 12px;
        font-size: 16px;
    }

    .search-instruction {
        font-size: 12px;
        padding: 8px;
    }

    .search-recommendations {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-height: 70vh;
        border-radius: 12px 12px 0 0;
        border: 2px solid rgba(52, 152, 219, 0.5);
        border-bottom: none;
        box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.3);
    }

    .recommendation-item {
        padding: 12px;
        min-height: 50px;
        gap: 10px;
    }

    .recommendation-name {
        font-size: 14px;
    }

    .recommendation-location {
        font-size: 10px;
    }

    .type-badge,
    .status-badge {
        font-size: 10px;
        padding: 2px 6px;
    }

    .display-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
    }

    .location-icon {
        width: 35px;
        height: 35px;
        font-size: 16px;
    }

    .location-text h3 {
        font-size: 16px;
    }

    .location-text p {
        font-size: 12px;
    }

    .view-full-btn {
        width: 100%;
        justify-content: center;
        font-size: 13px;
        padding: 10px;
    }

    .current-meal-section {
        margin-top: 15px;
    }

    .section-title {
        font-size: 16px;
        margin-bottom: 12px;
    }

    .meal-info {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }

    .meal-time,
    .meal-status {
        font-size: 13px;
    }

    .meal-items {
        grid-template-columns: 1fr;
        gap: 12px;
    }

    .meal-item {
        padding: 12px;
        font-size: 13px;
    }

    .canteen-menu-grid {
        grid-template-columns: 1fr;
        gap: 15px;
        max-width: 100%;
    }

    .menu-category {
        padding: 15px;
    }

    .category-title {
        font-size: 16px;
        margin-bottom: 12px;
    }

    .menu-item {
        padding: 8px 10px;
    }

    .menu-item-name,
    .menu-item-price {
        font-size: 13px;
    }

    .schedule-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
    }

    .schedule-title {
        font-size: 18px;
    }

    .back-button {
        width: 100%;
        justify-content: center;
        font-size: 13px;
        padding: 10px;
    }

    .schedule-table-container {
        margin: 0 -12px;
        padding: 0 12px;
    }

    .schedule-table {
        max-width: 100%; /* Full width for small screens */
        min-width: 0; /* Remove min-width constraint */
    }

    .schedule-table th,
    .schedule-table td {
        padding: 6px 4px;
        font-size: 10px;
        max-width: 80px;
    }

    .schedule-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 576px) {
    :root {
        --header-height: 65px;
    }

    .header {
        padding: 0 15px;
    }

    .menu-toggle {
        width: 36px;
        height: 36px;
        margin-right: 12px;
    }

    .menu-toggle span {
        width: 24px;
        height: 3px;
    }

    .logo img {
        height: 42px;
        margin-right: 12px;
    }

    .logo-text h1 {
        font-size: 18px;
    }

    .logo-text span {
        font-size: 12px;
    }

    .user-avatar {
        width: 36px;
        height: 36px;
        font-size: 15px;
    }

    .map-access {
        width: 36px;
        height: 36px;
        font-size: 18px;
    }

    .sidebar {
        top: var(--header-height);
        left: -100%;
        width: var(--sidebar-width);
        height: calc(100vh - var(--header-height));
    }

    .sidebar-menu a {
        padding: 10px 15px;
        font-size: 13px;
    }

    .sidebar-menu i {
        font-size: 18px;
        margin-right: 8px;
    }

    .main-content {
        padding: calc(var(--header-height) + 12px) 12px 15px;
        margin: 0 auto;
        max-width: 100%;
    }

    .page-title {
        font-size: 22px;
        padding-bottom: 10px;
    }

    .live-status-banner {
        padding: 10px;
        margin-bottom: 15px;
    }

    .live-indicator,
    .last-update,
    .countdown-info {
        font-size: 11px;
        gap: 6px;
    }

    .pulse-dot {
        width: 7px;
        height: 7px;
    }

    .search-section,
    .current-display,
    .full-menu-section {
        padding: 15px;
        margin-bottom: 15px;
    }

    .search-header h2 {
        font-size: 16px;
        gap: 6px;
    }

    .search-box input {
        padding: 10px 10px 10px 40px;
        font-size: 14px;
    }

    .search-box i {
        left: 10px;
        font-size: 14px;
    }

    .search-instruction {
        font-size: 11px;
        padding: 6px;
    }

    .recommendation-item {
        padding: 10px;
        min-height: 48px;
    }

    .recommendation-name {
        font-size: 13px;
        gap: 6px;
    }

    .recommendation-location {
        font-size: 10px;
    }

    .category-header {
        padding: 10px 12px;
        font-size: 12px;
    }

    .total-results-header {
        padding: 8px 12px;
        font-size: 12px;
    }

    .display-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
    }

    .location-icon {
        width: 32px;
        height: 32px;
        font-size: 14px;
    }

    .location-text h3 {
        font-size: 15px;
    }

    .location-text p {
        font-size: 11px;
    }

    .view-full-btn {
        font-size: 12px;
        padding: 8px;
    }

    .section-title {
        font-size: 15px;
        margin-bottom: 10px;
    }

    .meal-info {
        margin-bottom: 10px;
        padding-bottom: 8px;
    }

    .meal-time,
    .meal-status {
        font-size: 12px;
    }

    .meal-status {
        padding: 5px 10px;
    }

    .meal-items {
        gap: 10px;
    }

    .meal-item {
        padding: 10px;
        font-size: 12px;
    }

    .closed-message-content {
        gap: 12px;
        padding: 12px;
    }

    .closed-message-content i {
        font-size: 20px;
    }

    .closed-text h4 {
        font-size: 14px;
    }

    .closed-text p {
        font-size: 11px;
    }

    .menu-category {
        padding: 10px;
    }

    .category-title {
        font-size: 15px;
        margin-bottom: 10px;
        gap: 6px;
    }

    .category-title i {
        font-size: 18px;
    }

    .menu-item {
        padding: 6px 8px;
    }

    .menu-item-name,
    .menu-item-price {
        font-size: 12px;
    }

    .menu-item-price {
        padding: 3px 6px;
    }

    .schedule-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
    }

    .schedule-title {
        font-size: 16px;
        gap: 6px;
    }

    .back-button {
        font-size: 12px;
        padding: 8px;
    }

    .schedule-table {
        min-width: 0; /* Remove min-width */
        max-width: 100%; /* Full width */
    }

    .schedule-table th,
    .schedule-table td {
        padding: 5px 3px;
        font-size: 9px;
        max-width: 60px;
    }
}

@media (max-width: 480px) {
    body {
        font-size: 13px;
    }

    .main-container {
        padding: 0 8px;
    }

    .page-title {
        font-size: 18px;
    }

    .search-box input {
        font-size: 13px;
        padding: 8px 8px 8px 35px;
    }

    .search-box i {
        font-size: 13px;
    }

    .schedule-table {
        min-width: 0;
        max-width: 100%;
    }

    .schedule-table th,
    .schedule-table td {
        padding: 4px 2px;
        font-size: 8px;
        max-width: 50px;
    }

    .particle {
        animation-duration: 20s; /* Slower for performance */
    }
}

@media (max-width: 400px) {
    .logo-text h1 {
        font-size: 14px;
    }

    .logo-text span {
        font-size: 10px;
    }

    .page-title {
        font-size: 20px;
    }

    .map-access {
        width: 30px;
        height: 30px;
        font-size: 14px;
    }

    .schedule-table th,
    .schedule-table td {
        max-width: 40px;
    }
}

@media (min-width: 769px) {
    :root {
        --header-height: 90px;
        --sidebar-width: 280px;
    }

    .sidebar {
        left: calc(-1 * var(--sidebar-width));
        width: var(--sidebar-width);
        transition: all 0.3s ease;
    }

    .sidebar.active {
        left: 0;
    }

    .main-content {
        margin: 0 auto;
        max-width: 1500px;
    }

    .logo img {
        height: 60px;
    }

    .logo-text h1 {
        font-size: 28px;
    }

    .logo-text span {
        font-size: 16px;
    }

    .user-name {
        display: block;
    }

    .user-avatar {
        width: 50px;
        height: 50px;
        font-size: 20px;
        margin-right: 12px;
        border-width: 2px;
    }

    .map-access {
        width: 48px;
        height: 48px;
        font-size: 24px;
    }

    .menu-toggle {
        display: flex;
    }
}

@media (min-width: 992px) {
    .header {
        padding: 0 30px;
    }

    .logo img {
        height: 70px;
    }

    .logo-text h1 {
        font-size: 28px;
    }

    .logo-text span {
        font-size: 16px;
    }

    .user-name {
        font-size: 18px;
    }
}

@media (min-width: 1200px) {
    .main-content {
        padding: calc(var(--header-height) + 40px) 40px 40px;
        margin: 0 auto;
        max-width: 1500px;
    }
}

/* Touch Optimizations */
@media (pointer: coarse) {
    .menu-toggle,
    .map-access,
    .view-full-btn,
    .back-button,
    .filter-btn,
    .recommendation-item,
    .sidebar-menu a {
        min-width: 48px;
        min-height: 48px;
    }

    .search-box input {
        min-height: 48px;
        touch-action: manipulation; /* Improve touch responsiveness */
    }

    .filter-btn,
    .view-full-btn,
    .back-button {
        padding: 8px 12px;
    }
}

/* Ensure table text is readable */
.schedule-table td,
.schedule-table th {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
 </style>
</head>
<body>
    <!-- Background Particles -->
    <div class="bg-particles" id="bgParticles"></div>
    
    <!-- Header with Menu Toggle -->
    <header class="header">
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <div class="logo">
            <a href="/index.html" style="text-decoration: none; display: flex; align-items: center;">
                <img src="../images/logo1.png" alt="Scholars Stack Logo">
                <div class="logo-text">
                    <h1>Scholars Stack</h1>
                    <span>Smart Mess Menu</span>
                </div>
            </a>
        </div>
        
        <div class="header-actions">
            <div class="user-profile">
                <div class="user-avatar">
                    <img src="" alt="Profile Photo" id="userAvatar" style="display: none;">
                    <span>S</span>
                </div>
                <div class="user-name">Student</div>
            </div>
            <a href="#" class="map-access" title="Campus Map" aria-label="View Campus Map">
                <i class='bx bxs-map'></i>
            </a>
        </div>
    </header>
    
       <nav class="sidebar" id="sidebar">
        <div class="sidebar-title">Main Navigation</div>
        <ul class="sidebar-menu">
             <!-- <li><a href="#"><i class='bx bxs-dashboard'></i> Dashboard</a></li> -->
             <li><a href="../profile/profile.html"><i class='bx bxs-user'></i> Profile</a></li>
            <li><a href="../attendance/attendance.html"><i class='bx bxs-calculator'></i> Attendance Calculator</a></li>
            <li><a href="../gpa-calculator/cgpa.html"><i class='bx bxs-calculator'></i> CGPA Calculator</a></li>
            <li><a href="../ttmaker/ttmaker1.html"><i class='bx bxs-calendar'></i> Timetable Maker</a></li>
        </ul>
        
        <div class="sidebar-title">Resources</div>
        <ul class="sidebar-menu">
            <li><a href="../marketplace/market.html"><i class='bx bxs-store'></i> Marketplace</a></li>
            <li><a href="#" ><i class='bx bxs-group'></i> Club Info</a></li>
            <li><a href="../faculty/faculty.html" ><i class='bx bxs-group'></i> Faculty Info</a></li>
            <li><a href="../mess-menu/mess.html"class="active"><i class='bx bxs-food-menu'></i> Mess Menus</a></li>
        </ul>
        
        <div class="sidebar-title">Quick Links</div>
        <ul class="sidebar-menu">
            <li><a href="../mycourses/mycourses.html"><i class='bx bxs-graduation'></i> My Courses</a></li>
            <li><a href="../event/event.html"><i class='bx bxs-calendar-event'></i> Events</a></li>
        </ul>
        
        <div class="sidebar-title">Account</div>
        <ul class="sidebar-menu">
            <!-- <li><a href="#"><i class='bx bxs-cog'></i> Settings</a></li> -->
            <li><a href="#" class="logout-link"><i class='bx bxs-log-out'></i> Logout</a></li>
        </ul>
    </nav>    
   
    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        <h1 class="page-title">
            <i class='bx bxs-food-menu'></i> Mess Menus
        </h1>
        
        <div class="main-container">
            <!-- Live Status Banner -->
            <div class="live-status-banner">
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    <span>LIVE UPDATES</span>
                </div>
                
                <!-- <div class="last-update">
                    Last updated: <span id="globalLastUpdate">Just now</span>
                </div> -->
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-header">
                    <h2><i class="fas fa-search"></i> Find Your Mess or Canteen</h2>
                    <p>Search by name to see today's menu and timings</p>
                </div>
                
                <div class="search-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="mess-search" placeholder="Click here to see all messes and canteens...">
                    </div>
                    <div class="search-instruction">
                        <i class="fas fa-info-circle"></i>
                        <span>Click the search box above to see all available locations</span>
                    </div>
                    <div class="search-recommendations" id="search-recommendations">
                        <!-- Recommendations will appear here -->
                    </div>
                </div>
                
                <!-- Quick Filters -->
                <div class="quick-filters">
                    <div class="filters-header">
                        <h4><i class="fas fa-filter"></i> Quick Filters</h4>
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">
                            <i class="fas fa-list"></i> All
                        </button>
                        <button class="filter-btn" data-filter="mess">
                            <i class="fas fa-utensils"></i> Messes
                        </button>
                        <button class="filter-btn" data-filter="canteen">
                            <i class="fas fa-coffee"></i> Canteens
                        </button>
                        <button class="filter-btn" data-filter="night-canteen">
                            <i class="fas fa-moon"></i> Night Canteens
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Current Meal Display -->
            <div class="current-display" id="current-display">
                <div class="display-header">
                    <div class="location-info">
                        <div class="location-icon">
                            <i class="fas fa-utensils" id="location-icon"></i>
                        </div>
                        <div class="location-text">
                            <h3 id="location-name">Boys Hostel Mess 1</h3>
                            <p id="location-details">Hostel Block A â€¢ Open until 8:45 PM</p>
                        </div>
                    </div>
                    <button class="view-full-btn" id="view-full-btn" style="display: none;">
                        <i class="fas fa-calendar-week"></i>
                        View Full Schedule
                    </button>
                </div>
                
                <div class="current-meal-section">
                    <div class="section-title">
                        <i class="fas fa-clock" id="meal-icon"></i>
                        <h3 id="current-time-title">Current Meal</h3>
                    </div>
                    
                    <div class="meal-info">
                        <div class="meal-time">
                            <i class="fas fa-calendar-day"></i>
                            <span id="current-date">Monday, June 12</span>
                        </div>
                        <div class="meal-status" id="meal-status">Breakfast: 7:00 AM - 9:30 AM</div>
                    </div>
                    
                    <div class="meal-items" id="current-meal-items">
                        <!-- Current meal items will be dynamically added -->
                    </div>
                </div>
            </div>
            
            <!-- Full Menu Section -->
            <div class="full-menu-section" id="full-menu-section">
                <div class="schedule-header">
                    <button class="back-button" id="back-button">
                        <i class="fas fa-arrow-left"></i>
                        Back to Current Menu
                    </button>
                    <h3 class="schedule-title">
                        <i class="fas fa-calendar-week"></i>
                        Weekly Menu: <span id="full-menu-name"></span>
                    </h3>
                </div>
                
                <table class="schedule-table" id="weekly-schedule">
                    <thead>
                        <tr>
                            <th>Breakfast</th>
                            <th>Lunch</th>
                            <th>Snacks</th>
                            <th>Dinner</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Weekly schedule will be dynamically added -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Toggle sidebar
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });
        
        document.addEventListener('click', (e) => {
            if (sidebar.classList.contains('active') &&
                !sidebar.contains(e.target) &&
                !menuToggle.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });

        // Sidebar link active state and close on mobile after navigation
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', () => {
                document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                if (window.matchMedia('(max-width: 768px)').matches) {
                    sidebar.classList.remove('active');
                }
            });
        });

        // Create background particles
        function createParticles() {
            const particlesContainer = document.getElementById('bgParticles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // Random size
                const size = Math.random() * 60 + 20;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.left = `${Math.random() * 100}%`;
                
                // Random animation delay
                particle.style.animationDelay = `${Math.random() * 10}s`;
                
                // Random opacity
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Enhanced mock data with subtypes
        const locations = [
{
    "id": 1,
    "name": "JMB",
    "location": "Dinning Hall First Floor",
    "type": "mess",
    "subtype": "boys",
    "favorite": false,
    "timing": {
        "breakfast": { "start": "7:30 AM", "end": "9:00 AM" },
        "lunch": { "start": "12:30 PM", "end": "2:00 PM" },
        "snacks": { "start": "5:00 PM", "end": "6:00 PM" },
        "dinner": { "start": "7:30 PM", "end": "8:45 PM" }
    },
    "weeklyMenu": {
        "Monday": {
            "breakfast": ["Steamed Idli","Medu Vada", "Sambhar", "Assorted Chutney", "Fruit", "Bread Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Aloo Matar Jhol Wali", "Jeera Rice", "Tawa Roti","Yellow Dal", "Fryums", "Fresh Salad", "Boondi Raita", "Mango Pickle"],
            "snacks": ["Aloo Pyaaj Kachori", "Green Chutney", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti", "Punjabi Dum Aloo", "Steam Rice", "Dal Fry", "Noodles", "Manchurian", "Fresh Salad", "Pickle"]
        },
        "Tuesday": {
            "breakfast": ["Aloo Matar Paratha","chilled chilly Yougut","Sprouts Salad", "Fruit", "Bread Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Punjabi Chole", "Ghee Rice", "Dal Tadka", "Tawa Roti", "Fryums", "Veg Raita","Pickle"],
            "snacks": ["Fried Idli", "Coconut Chutney", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti", "Methi Matar Malai", "Aloo Gobhi Masala", "Dal Yellow", "Jeera Rice", "Fresh Salad", "Pickle"]
        },
        "Wednesday": {
            "breakfast": ["Masala Dal with Chutney", "Pakwan","Chickpeas Salad", "Fruit", "Bread Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Aloo Shimla", "Moong Dal Palak", "Tawa Roti", "Steam Rice","Khajoor ki Launji","Tadke Wala Dahi"],
            "snacks": ["Samosa", "Mint Chutney", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti", "Dal Hari Mirch", "Seasonal Veg", "Rajma Masala", "Matar Pulao", "Fresh Salad", "Pickle"]
        },
        "Thursday": {
            "breakfast": ["Upma", "Pongal Bhhat","Sambar & Chutney", "Fruit", "Bread Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Tadke Wali Chach", "Gatte Ki Sabzi", "Veg Pulao","Tomato Dal","Sada Bati","churma","Chutney", "Pickle", "Fresh Salad"],
            "snacks": ["Vada Pav", "Fried Green chilly", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti","Tomato Soup", "Hara Chana Lapatka", "Jeera Rice", "Dal Tadka", "Chilli Soya Paneer","Potato Wedges", "Fresh Salad", "Pickle"]
        },
        "Friday": {
            "breakfast": ["Bhature","chole masala", "or","Pav Bhaji", "Fruit", "Bread Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Aloo Gobi Masala", "Kadi Pakoda", "Veg Pulao","puri", "Fryums", "Kesariya Kheer", "Fresh Salad", "Pickle"],
            "snacks": ["Bread Pakoda", "Green Chutney", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti", "Kali Dal","Steam Rice", "Aloo  Methi Masala ", "Matar Tamatar Semi Gravy", "Fresh Salad", "Pickle"]
        },
        "Saturday": {
            "breakfast": ["Masala Dosa", "Sambar", "Assorted Chutney", "Fruit", "Bread Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Rajma Masala", "Jeera Rice","Hari Mirch Dal Tadka", "Tawa Roti", "Pickle", "Fryums", "Fresh Salad", "Boondi Raita"],
            "snacks": ["Bombay Masala Bhel", "Khaman", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti","aloo kanada masala rice","veg raita","Dal Fry","methi curry kofta","Fresh Salad"]
        },
        "Sunday": {
            "breakfast": ["Poha", "Usal","Kachori","Assorted Fruit", "Bread", "Butter Jam", "Milk Tea Coffee"],
            "lunch": ["Paneer Chana", "Dal Makhani", "Veg Jalfrezi", "Tawa Roti", "Biryani","Fryums", "Salad", "Pickle","Cucumber Raita"],
            "snacks": ["Variety of Pasta", "Milk Tea Coffee"],
            "dinner": ["Tawa Roti", "Panner Kadhai", "Seasonal veg", "Jeera Rice", "Fresh Salad", "Moong Dal Halwa"]
        }
    }
},
{
    "id": 2,
    "name": "CRCL",
    "location": "Boys Hostel Block-1",
    "type": "mess",
    "subtype": "boys",
    "favorite": false,
    "timing": {
        "breakfast": { "start": "7:30 AM", "end": "9:00 AM" },
        "lunch": { "start": "12:30 PM", "end": "2:00 PM" },
        "snacks": { "start": "5:00 PM", "end": "6:00 PM" },
        "dinner": { "start": "7:30 PM", "end": "8:45 PM" }
    },
    "weeklyMenu": {
        "Monday": {
            "breakfast": ["Idly", "Sambhar, Chutney", "Banana/Fruit Salad", "Midhu Vada", "Bread, Butter Jam", "Milk, Tea", "Coffee"],
            "lunch": ["Salad", "Roti", "Kadi Pokkoda", "Aloo Jeera", "Rice", "Moure Kuzhambu", "Aloo Poriyal", "Rasam", "Pickle"],
            "snacks": ["Stuffed Kachori", "Chutney", "Tea/Cofee/Milk"],
            "dinner": ["Roti", "Aloo Mater Masala", "Egg Curry", "Dal Fry", "Rice", "Rasam", "Pickle"]
        },
        "Tuesday": {
            "breakfast": ["Variety Paratha", "Dahi/Veg Subji", "Banana/Fruit Salad", "Bread", "Butter Jam", "Milk, Tea", "Coffee"],
            "lunch": ["Salad", "Roti", "Kala Channa Sabji", "Garlic Dal", "Plain Rice", "Brinjal Puli Kuttu", "Green Chutney", "Rasam", "Andra Pappu"],
            "snacks": ["Vada Pav", "Tea/Cofee/Milk"],
            "dinner": ["Roti", "Veg 65", "Rajastani Dal", "Mutter Pualo", "Rice", "Rasam", "Pickle", "Fruit Custard/Sooji Halwa"]
        },
        "Wednesday": {
            "breakfast": ["Variety Uthappam", "Sambar", "Karachutney", "Bread", "Butter Jam", "Milk, Tea", "Coffee"],
            "lunch": ["Salad", "Roti", "Veg Kofta", "Rice", "Dal Fry", "Sambar", "Beetroot Poriyal", "Rasam", "Payasam, Sweet Boondhi"],
            "snacks": ["Sambar Vada", "Tea/Cofee/Milk"],
            "dinner": ["Roti", "Plain Dal", "Rice", "Varity Chicken", "Varity Paneer", "Rasam", "Pickle"]
        },
        "Thursday": {
            "breakfast": ["Pav", "Bhaji", "Butter", "Jam", "Milk, Tea, Cofee", "Egg, Sprout"],
            "lunch": ["Salad", "Roti", "Chana Lauki Masala", "Tomato Dal", "Veg Pulao", "Plain Rice","Karakuzhambu", "Rasam", "Variety Kootu", "Butter Milk"],
            "snacks": ["Samosa", "Green Chutney", "Tea/Cofee/Milk"],
            "dinner": ["Roti", "Panjabi Dal", "Matar Meal Mekar Masala", "Rice", "Sambar", "Pickle","Rasam"]
        },
        "Friday": {
            "breakfast": ["Bhatura/Poori", "Chole Masala/Aloo Masala", "Banana/Fruit Salad", "Butter", "Jam", "Milk, Tea", "Coffee"],
            "lunch": ["Boondhi Raitha", "Veg Biriyani", "Roti", "Aloo Gobi Capsicum", "Plain Rice", "Sambar", "Raw Banana Poriyal", "Rasam", "Fryums", "Pickle"],
            "snacks": ["Sweet Corn Peanut Sundal/Misal Pav", "Tea/Cofee/Milk"],
            "dinner": ["Roti","Rice", "Dal Tadka", "Varity Chicken", "Varity Paneer", "Rasam", "Pickle"]
        },
        "Saturday": {
            "breakfast": ["Poha", "Jalebi", "Banana/Fruit Salad", "Pongal, Sambar", "Bread, Butter Jam", "Milk, Tea, Cofee", "Egg, Sprout"],
            "lunch": ["Salad", "Roti", "Rajma Ghawrawala", "Jeera Rice", "Mix Veg Sabji", "Rice", "Garlic Kara Kuzhambu/Pokoda Kuzhambu", "Bhindi Poriyal", "Rasam", "Butter Milk", "Pickle"],
            "snacks": ["Mysore Bonda/Aloo Papadi Chat", "Tea/Cofee/Milk"],
            "dinner": ["Chapathi","Fried Rice", "Dal Fry", "Monchuriyan Gravy", "Sambar", "Rice", "Pickle"]
        },
        "Sunday": {
            "breakfast": ["Masala Dosa", "Sambar, Chutney", "Banana/Fruit Salad", "Bread", "Butter Jam", "Milk, Tea", "Coffee"],
            "lunch": ["Onion Cucumber Raita", "Roti", "Chicken Biryani", "Veg Biriyani","Paneer Butter Masala", "Pickle"],
            "snacks": ["Dhokala/Pasta", "Green Chutney", "Tea/Cofee/Milk"],
            "dinner": ["Chapathi", "Rice", "Kashmiri Dum Aloo", "Dal Makhani", "Rasam", "Pickle", "Gulab Jamun"]
        }
    }
    
},
{
  "id": 3,
  "name": "Safal",
  "location": "Dinning Hall Second Floor",
  "type": "mess",
  "subtype": "boys",
  "favorite": false,
  "timing": {
    "breakfast": { "start": "7:30 AM", "end": "9:00 AM" },
    "lunch": { "start": "12:30 PM", "end": "2:00 PM" },
    "snacks": { "start": "5:00 PM", "end": "6:00 PM" },
    "dinner": { "start": "7:30 PM", "end": "8:45 PM" }
  },
  "weeklyMenu": {
    "Monday": {
      "breakfast": ["Idli", "Vada", "Sambhar", "Chutney", "Banana", "Chutney", "Bread Butter Jam", "Tea Milk Coffee"],
      "lunch": ["Mix Salad", "Kadhai Veg/Lounki Chana Masala", "Dal Tadka", "Plain Rice", "South Indian Plain Rice", "Roti", "Tamarind Kara Khuzambu", "Carrot Beans Poriyal", "Pepper Rasam", "Pickle", "Butter Milk"],
      "snacks": ["Dabeli", "Sauce/Chutney", "Tea Coffee Milk"],
      "dinner": ["Egg Gravy", "Dum Aloo", "Dal Fry", "Plain Rice", "Roti", "Tomato Rasam", "Pickle", "South Indian Plain Rice"]
    },
    "Tuesday": {
      "breakfast": ["Poha", "Jalebi", "Jeeraman", "Pongal", "Chutney", "Mix Cut Fruit Salad", "Bread Butter Jam", "Tea Milk Coffee"],
      "lunch": ["Fryums", "Chhole", "Puri", "Plain Rice", "South Indian Plain Rice", "Roti", "Mix Dal", "Bottle Gourd Kuzhambu", "Tomato Rasam", "Pickle", "Juice"],
      "snacks": ["Veg Cutlet/Sweet Corn", "Sauce", "Tea Coffee Milk"],
      "dinner": ["Mix Veg/Aloo Bhindi Peanut Masala", "Dal Tadka", "Curd Rice (South)", "Plain Rice", "Roti", "Plain Rasam", "Pickle", "Fruit Custard"]
    },
    "Wednesday": {
      "breakfast": ["Vermicelli Upma", "Chutney", "Banana", "Bread Butter Jam", "Tea Milk Coffee", "Boiled Egg", "Sprouts"],
      "lunch": ["Mix Salad", "Veg Kofta", "Dal Tadka", "Mutter Pulao", "South Indian Plain Rice", "Roti", "Vegetable Sambhar", "Paruppu Rasam", "Sweet Bundi", "Pickle", "Boondi Raita"],
      "snacks": ["Samosa/Kachori", "Green Chutney", "Tea Coffee Milk"],
      "dinner": ["Kadai Chicken Masala", "Paneer Masala", "Plain Dal", "Roti", "Plain Rice", "South Indian Plain Rice", "Pepper Rasam", "Pickle"]
    },
    "Thursday": {
      "breakfast": ["Masala Paratha", "Curd", "Bhaji", "Mix Cut Fruit Salad", "Bread Butter Jam", "Tea Milk Coffee", "Boiled Egg", "Sprouts"],
      "lunch": ["Fryums", "Rajma Masala", "Plain Rice", "South Indian Plain Rice", "Roti", "Louki More", "Beetroot Poriyal", "Plain Rasam", "Pickle", "Juice"],
      "snacks": ["Aloo Vada/Fried Idli", "Tamarind Chutney", "Tea Coffee Milk"],
      "dinner": ["Egg Gravy", "Black Chana", "Dal Fry", "Roti", "Jeera Rice", "Butter Roti", "Plain Rasam", "Tomato Soup"]
    },
    "Friday": {
      "breakfast": ["Uthappam", "Onion Tomato Chutney", "Banana", "Bread Butter Jam", "Tea Milk Coffee", "Boiled Egg", "Sprouts"],
      "lunch": ["Kadi Pakoda", "Plain Rice", "Dal Fry", "Roti", "Brinjal Kuzhambu", "Veg Avial", "Pickle", "Mix Salad", "South Indian Plain Rice", "Butter Milk"],
      "snacks": ["Veg Chowmin", "Aloo Masala", "Tea Coffee Milk"],
      "dinner": ["Butter Chicken", "Kadai Paneer", "Dal Tadka", "Roti", "Rice", "South Indian Plain Rice", "Rasam"]
    },
    "Saturday": {
      "breakfast": ["Chole Bhature", "Mix Cut Fruit Salad", "Bread Butter Jam", "Tea Milk Coffee"],
      "lunch": ["Fryums", "Aloo Mutter Masala", "Mix Dal", "Jeera Rice", "Roti", "Potato Poriyal", "Pepper Rasam", "Pickle", "South Indian Plain Rice", "Curd"],
      "snacks": ["Dhokla", "Green Chutney", "Tea Coffee Milk"],
      "dinner": ["Veg Manchurian", "Veg Fried Rice", "Veg Manchow Soup", "Dal Fry", "Roti", "Pickle"]
    },
    "Sunday": {
      "breakfast": ["Masala Dosa/Mix Veg Dosa", "Sambhar", "Chutney", "Banana", "Bread Butter Jam", "Tea Milk Coffee", "Boiled Egg", "Sprouts"],
      "lunch": ["Veg Biryani", "Chicken Biryani", "Onion Cucumber Raita", "Dal Kolhapuri", "Roti", "Butter Paneer Masala", "Pickle", "Juice"],
      "snacks": ["Pasta", "Sauce/Chutney", "Tea Coffee Milk"],
      "dinner": ["Veg 65/Aaloo Soya Badi", "Dal Makhani", "Plain Rice", "Roti", "Bhindi Poriyal", "South Indian Plain Rice", "Paruppu Rasam", "Gulab Jamun"]
    }
  }
},
                // {
                //     "id": 5,
                //     "name": " Mayuri Girls ",
                //     "location": "Mayuri Dining Hall",
                //     "type": "mess",
                //     "subtype": "girls",
                //     "favorite": false,
                //     "timing": {
                //         "breakfast": { "start": "7:30 AM", "end": "9:00 AM" },
                //         "lunch": { "start": "12:30 PM", "end": "2:00 PM" },
                //         "snacks": { "start": "5:00 PM", "end": "6:00 PM" },
                //         "dinner": { "start": "7:30 PM", "end": "8:45 PM" }
                //     },
                //     "weeklyMenu": {
                //         "Monday": {
                //             "breakfast": ["Idly Vada", "Sambar", "Chutney", "Banana/Fruit Salad", "Bread", "Butter/Jam", "Milk, Tea, Coffee", "Boiled Egg"],
                //             "lunch": ["Cucumber Salad", "Paneer Kofta", "Dal Tadka", "Plain Rice", "South Indian Rice", "Tamarind Kara Kuzhambu", "Carrot Beans Poriyal", "Papad", "Pickle", "Buttermilk"],
                //             "snacks": ["Noodles", "Sauce/Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Egg Gravy", "Dum Aloo", "Dal Fry", "Plain Rice", "Roti", "South Indian Rice", "Tomato Rasam", "Pickle", "Fruit Custard"]
                //         },
                //         "Tuesday": {
                //             "breakfast": ["Poha, Jalebi", "Pongal", "Chutney", "Jeerawan Masala", "Mix Fruit", "Bread", "Butter Jam", "Milk, Tea, Coffee", "Sprouts"],
                //             "lunch": ["Fryums", "Chole", "Mix Dal", "Plain Rice", "South Indian Rice", "Bottle Gourd Kuzhambu", "Tomato Rasam", "Pickle", "Juice"],
                //             "snacks": ["Veg Cutlet", "Sauce/Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Mix Veg", "Dal Tadka", "Plain Rice", "Roti", "South Indian Rice", "Rasam", "Pickle"]
                //         },
                //         "Wednesday": {
                //             "breakfast": ["Vermicelli Upma", "Chutney", "Banana", "Bread", "Butter Jam", "Milk, Tea, Coffee", "Boiled Egg"],
                //             "lunch": ["Mix Salad", "Veg Kofta", "Mutter Pulav", "Roti", "South Indian Rice", "Vegetable Sambar", "Sweet Bundi", "Paruppu Rasam", "Pickle", "Boondi Raita"],
                //             "snacks": ["Samosa", "Kachori", "Green Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Kadai Chicken", "Paneer Masala", "Plain Dal", "Rice", "Roti", "South Indian Rice", "Papad", "Pickle", "Tomato Soup"]
                //         },
                //         "Thursday": {
                //             "breakfast": ["Masala Paratha", "Curd", "Bhaji", "Fruit Mix Salad", "Bread", "Butter Jam", "Milk, Tea, Coffee"],
                //             "lunch": ["Fryums", "Rajma", "Plain Dal", "Rice", "South Indian Rice", "Bottle Gourd Moru", "Beetroot Poriyal", "Plain Rasam", "Pickle", "Juice"],
                //             "snacks": ["Aloo Vada/Bread", "Sauce Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Egg Gravy", "Black Chana", "Dal Fry", "Jeera Rice", "Roti", "South Indian Rice", "Ginger Rasam", "Pickle"]
                //         },
                //         "Friday": {
                //             "breakfast": ["Uthappam", "Onion Tomato Chutney", "Banana", "Fruit Salad", "Bread", "Butter Jam", "Milk, Tea, Coffee", "Boiled Egg"],
                //             "lunch": ["Cucumber Salad", "Kadi Pakoda", "Dal", "Roti", "South Indian Rice", "Brinjal Kuzhambu", "Rasam", "Pickle", "Curd"],
                //             "snacks": ["Pani Puri", "Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Chicken Biryani", "Onion Cucumber Raita", "Dal Kolhapuri", "Veg Biryani", "Roti", "Mutter Paneer Masala", "Pickle"]
                //         },
                //         "Saturday": {
                //             "breakfast": ["Chole", "Sambar", "Chutney", "Banana/Fruit Salad", "Bread", "Butter Jam", "Milk, Tea, Coffee", "Sprouts"],
                //             "lunch": ["Gobi Milli", "Mix Veg", "Jeera Rice", "Roti", "South Indian Rice", "Potato Poriyal", "Papad", "Rasam", "Pickle", "Lemon Juice"],
                //             "snacks": ["Dhokla", "Green Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Manchurian", "Dal Fry", "Fried Rice", "Roti", "Rasam", "Pickle", "Gulab Jamun"]
                //         },
                //         "Sunday": {
                //             "breakfast": ["Masala Dosa", "Mix Veg Dosa", "Sambar", "Chutney", "Banana/Fruit Salad", "Bread", "Butter Jam", "Milk, Tea, Coffee", "Sprouts"],
                //             "lunch": ["Veg - 65", "Dal Makhani", "Rice", "Roti", "South Indian Rice", "Bhindi Poriyal", "Paruppu Rasam", "Pickle", "Lemon Juice"],
                //             "snacks": ["Pasta", "Sauce/Chutney", "Tea/Coffee, Milk"],
                //             "dinner": ["Butter Chicken", "Kadai Paneer", "Dal Tadka", "Roti", "South Indian Rice", "Pickle"]
                //         }
                //     }
                // },
                // {
                //     id: 3,
                //     name: "Central Canteen",
                //     location: "Main Building",
                //     type: "canteen",
                //     subtype: "normal",
                //     favorite: false,
                //     menu: {
                //         "Beverages": [
                //             { name: "Coffee", price: 25 },
                //             { name: "Tea", price: 15 },
                //             { name: "Fresh Juices", price: 40 },
                //             { name: "Milkshakes", price: 50 }
                //         ],
                //         "Snacks": [
                //             { name: "Sandwich", price: 50 },
                //             { name: "Burger", price: 70 },
                //             { name: "French Fries", price: 45 },
                //             { name: "Veg Puffs", price: 35 },
                //             { name: "Samosa", price: 30 }
                //         ],
                //         "Main Course": [
                //             { name: "Margherita Pizza", price: 120 },
                //             { name: "Paneer Tikka Pizza", price: 150 },
                //             { name: "Pasta", price: 100 },
                //             { name: "Noodles", price: 90 },
                //             { name: "Veg Biryani", price: 110 }
                //         ],
                //         "Desserts": [
                //             { name: "Chocolate Cake", price: 60 },
                //             { name: "Brownie", price: 55 },
                //             { name: "Ice Cream Sundae", price: 75 }
                //         ]
                //     }
                // },
                // {
                //     id: 7,
                //     name: "Campus Cafe",
                //     location: "Near Admin Block",
                //     type: "canteen",
                //     subtype: "normal",
                //     favorite: false,
                //     menu: {
                //         "Beverages": [
                //             { name: "Cappuccino", price: 65 },
                //             { name: "Latte", price: 70 },
                //             { name: "Smoothies", price: 85 },
                //             { name: "Iced Tea", price: 50 }
                //         ],
                //         "Bakery": [
                //             { name: "Croissant", price: 45 },
                //             { name: "Muffin", price: 55 },
                //             { name: "Donut", price: 40 },
                //             { name: "Cinnamon Roll", price: 60 }
                //         ],
                //         "Salads & Sandwiches": [
                //             { name: "Garden Salad", price: 75 },
                //             { name: "Chicken Sandwich", price: 95 },
                //             { name: "Veggie Wrap", price: 80 },
                //             { name: "Grilled Cheese", price: 65 }
                //         ]
                //     }
                // },
                // {
                //     id: 4,
                //     name: "Night Canteen",
                //     location: "Near Library",
                //     type: "canteen",
                //     subtype: "night",
                //     favorite: false,
                //     menu: {
                //         "Late Night Specials": [
                //             { name: "Maggi", price: 40 },
                //             { name: "Cheese Maggi", price: 50 },
                //             { name: "Veg Burger", price: 60 },
                //             { name: "Chicken Burger", price: 80 },
                //             { name: "Grilled Sandwich", price: 70 }
                //         ],
                //         "Beverages": [
                //             { name: "Hot Chocolate", price: 45 },
                //             { name: "Tea", price: 20 },
                //             { name: "Coffee", price: 30 },
                //             { name: "Cold Coffee", price: 50 }
                //         ]
                //     }
                // },
                // {
                //     id: 6,
                //     name: "Girls Hostel Mess 2",
                //     location: "South Wing",
                //     type: "mess",
                //     subtype: "girls",
                //     favorite: false,
                //     timing: {
                //         breakfast: { start: "7:30 AM", end: "9:00 AM", menu: ["Idli", "Vada", "Sambar", "Chutney"] },
                //         lunch: { start: "12:30 PM", end: "2:00 PM", menu: ["Rice", "Sambar", "Rasam", "Beans Fry"] },
                //         snacks: { start: "5:00 PM", end: "6:00 PM", menu: ["Tea", "Biscuits", "Banana"] },
                //         dinner: { start: "7:30 PM", end: "8:45 PM", menu: ["Roti", "Paneer", "Dal", "Rice"] }
                //     },
                //     weeklyMenu: {
                //         Monday: {
                //             breakfast: ["Idli", "Vada", "Sambar", "Chutney"],
                //             lunch: ["Rice", "Sambar", "Rasam", "Beans Fry"],
                //             snacks: ["Tea", "Biscuits", "Banana"],
                //             dinner: ["Roti", "Paneer", "Dal", "Rice"]
                //         },
                //         Tuesday: {
                //             breakfast: ["Dosa", "Sambar", "Chutney"],
                //             lunch: ["Biryani", "Raita", "Salad"],
                //             snacks: ["Juice", "Puffs"],
                //             dinner: ["Fried Rice", "Manchurian"]
                //         },
                //         Wednesday: {
                //             breakfast: ["Puri", "Aloo Sabzi"],
                //             lunch: ["Rice", "Dal", "Paneer"],
                //             snacks: ["Tea", "Samosa"],
                //             dinner: ["Chappathi", "Channa Masala"]
                //         },
                //         Thursday: {
                //             breakfast: ["Poha", "Upma"],
                //             lunch: ["Rice", "Sambar", "Rasam"],
                //             snacks: ["Coffee", "Vada"],
                //             dinner: ["Roti", "Mix Veg"]
                //         },
                //         Friday: {
                //             breakfast: ["Aloo Paratha"],
                //             lunch: ["Jeera Rice", "Rajma"],
                //             snacks: ["Juice", "Cake"],
                //             dinner: ["Fried Rice", "Chilli Chicken"]
                //         },
                //         Saturday: {
                //             breakfast: ["Uttapam", "Sambar"],
                //             lunch: ["Rice", "Dal Fry"],
                //             snacks: ["Tea", "Pakoda"],
                //             dinner: ["Roti", "Paneer Butter Masala"]
                //         },
                //         Sunday: {
                //             breakfast: ["Puri", "Aloo Sabzi"],
                //             lunch: ["Rice", "Sambar", "Rasam"],
                //             snacks: ["Coffee", "Biscuits"],
                //             dinner: ["Roti", "Chana Masala"]
                //         }
                //     }
                // }
        ];

        // DOM Elements
        const searchInput = document.getElementById('mess-search');
        const searchResults = document.getElementById('search-recommendations');
        const currentDisplay = document.getElementById('current-display');
        const locationName = document.getElementById('location-name');
        const locationDetails = document.getElementById('location-details');
        const currentDate = document.getElementById('current-date');
        const mealStatus = document.getElementById('meal-status');
        const currentMealItems = document.getElementById('current-meal-items');
        const viewFullBtn = document.getElementById('view-full-btn');
        const fullMenuSection = document.getElementById('full-menu-section');
        const fullMenuName = document.getElementById('full-menu-name');
        const weeklySchedule = document.getElementById('weekly-schedule') ? document.getElementById('weekly-schedule').querySelector('tbody') : null;
        const backButton = document.getElementById('back-button');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const countdownTimer = document.getElementById('countdown-timer');
        const globalLastUpdate = document.getElementById('globalLastUpdate');
        const locationIcon = document.getElementById('location-icon');
        const mealIcon = document.getElementById('meal-icon');
        const currentTimeTitle = document.getElementById('current-time-title');

        // State variables
        let selectedLocation = null;
        let favorites = JSON.parse(localStorage.getItem('messFavorites')) || [];
        let activeFilter = 'all';
        let countdownInterval = null;

        // Initialize the app
        function init() {
            try {
                // Set current date
                const now = new Date();
                if (currentDate) currentDate.textContent = formatDate(now);
                
                // Update last updated time
                if (globalLastUpdate) globalLastUpdate.textContent = formatTime(now);
                
                // Add event listeners
                if (searchInput) {
                    searchInput.addEventListener('input', handleSearch);
                    searchInput.addEventListener('focus', () => {
                        resetFilters();
                        showAllRecommendations();
                    });
                    searchInput.addEventListener('click', () => {
                        resetFilters();
                        showAllRecommendations();
                    });
                }
                
                if (viewFullBtn) {
                    viewFullBtn.addEventListener('click', showFullSchedule);
                }
                
                if (backButton) {
                    backButton.addEventListener('click', hideFullSchedule);
                }
                
                // Add filter button listeners
                filterButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        filterButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        activeFilter = btn.dataset.filter;
                        
                        if (searchInput && searchInput.value === '') {
                            showAllRecommendations();
                        } else {
                            handleSearch();
                        }
                    });
                });
                
                // Close search results when clicking outside
                document.addEventListener('click', (e) => {
                    if (searchResults && !searchResults.contains(e.target) && !searchInput.contains(e.target)) {
                        searchResults.classList.remove('show');
                        setTimeout(() => {
                            if (searchResults && !searchResults.classList.contains('show')) {
                                searchResults.style.display = 'none';
                            }
                        }, 300);
                    }
                });
                
                // Load favorites
                loadFavorites();
                
                // Start live updates
                startLiveUpdates();
                
                // Handle window resize and scroll for search results positioning
                window.addEventListener('resize', () => {
                    if (searchResults && searchResults.style.display !== 'none') {
                        positionSearchResults();
                    }
                    
                    // Re-equalize grid heights on resize for canteen menus
                    if (selectedLocation && selectedLocation.type === 'canteen') {
                        setTimeout(() => {
                            equalizeGridHeights();
                        }, 100);
                    }
                });
                
                window.addEventListener('scroll', () => {
                    if (searchResults && searchResults.style.display !== 'none') {
                        positionSearchResults();
                    }
                });
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('Error initializing app. Please refresh the page.', 'error');
            }
        }

        // Reset quick filters to 'all'
        function resetFilters() {
            try {
                activeFilter = 'all';
                filterButtons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.filter === 'all') {
                        btn.classList.add('active');
                    }
                });
            } catch (error) {
                console.error('Error resetting filters:', error);
                showNotification('Error resetting filters. Please try again.', 'error');
            }
        }

        // Show all recommendations
        function showAllRecommendations() {
            try {
                if (!searchResults) return;
                
                // Always show all locations when search box is clicked
                const allLocations = filterLocations('');
                displaySearchResults(allLocations);
                searchResults.style.display = 'block';
                // Add small delay for smooth animation
                setTimeout(() => {
                    searchResults.classList.add('show');
                }, 10);
                
                // Add a helpful message
                if (searchResults.querySelector('.help-message')) {
                    searchResults.querySelector('.help-message').remove();
                }
                
                const helpMessage = document.createElement('div');
                helpMessage.className = 'help-message';
                helpMessage.innerHTML = '<i class="fas fa-info-circle"></i> Showing all available locations. Type to search or use filters below.';
                helpMessage.style.cssText = 'padding: 15px 20px; background: rgba(52, 152, 219, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: var(--accent-blue); font-size: 14px; text-align: center;';
                searchResults.insertBefore(helpMessage, searchResults.firstChild);
                
                // Add scroll indicator if there are many results
                if (allLocations.length > 8) {
                    const scrollIndicator = document.createElement('div');
                    scrollIndicator.className = 'scroll-indicator';
                    scrollIndicator.innerHTML = '<i class="fas fa-chevron-down"></i> Scroll to see more options';
                    scrollIndicator.style.cssText = 'padding: 10px 20px; background: rgba(52, 152, 219, 0.2); color: var(--accent-blue); font-size: 12px; text-align: center; border-top: 1px solid rgba(255, 255, 255, 0.1);';
                    searchResults.appendChild(scrollIndicator);
                }
                
            } catch (error) {
                console.error('Error showing all recommendations:', error);
                showNotification('Error loading recommendations. Please try again.', 'error');
            }
        }

        // Handle search input
        function handleSearch() {
            try {
                if (!searchInput) return;
                
                const searchTerm = searchInput.value.toLowerCase();
                
                // If search is empty, show all recommendations
                if (searchTerm === '') {
                    showAllRecommendations();
                    return;
                }
                
                const filteredLocations = filterLocations(searchTerm);
                displaySearchResults(filteredLocations);
            } catch (error) {
                console.error('Error handling search:', error);
                showNotification('Error performing search. Please try again.', 'error');
            }
        }

        // Filter locations based on search term and active filter
        function filterLocations(searchTerm) {
            try {
                if (!locations || !Array.isArray(locations)) return [];
                
                return locations.filter(location => {
                    try {
                        if (!location || !location.name || !location.location) return false;
                        
                        const matchesSearch = location.name.toLowerCase().includes(searchTerm) || 
                                             location.location.toLowerCase().includes(searchTerm);
                        
                        // Apply filter
                        if (activeFilter === 'mess') {
                            return matchesSearch && location.type === 'mess';
                        } else if (activeFilter === 'canteen') {
                            return matchesSearch && location.type === 'canteen';
                        } else if (activeFilter === 'night-canteen') {
                            return matchesSearch && location.type === 'canteen' && location.subtype === 'night';
                        }
                        return matchesSearch; // 'all' filter
                    } catch (error) {
                        console.error('Error filtering location:', location, error);
                        return false;
                    }
                });
            } catch (error) {
                console.error('Error filtering locations:', error);
                return [];
            }
        }

        // Check if a location is currently open
        function isLocationOpen(location) {
            try {
                if (!location || !location.type) return false;
                
                if (location.type === 'canteen' || location.type === 'night-canteen') {
                    // Canteens are always open
                    return true;
                }
                
                // For messes, check current meal
                const currentMeal = getCurrentMeal(location);
                return currentMeal && currentMeal.status !== 'closed';
            } catch (error) {
                console.error('Error checking if location is open:', error);
                return false;
            }
        }

        // Display search results with subcategories
        function displaySearchResults(results) {
            try {
                if (!searchResults) return;
                
                searchResults.innerHTML = '';
                
                if (results.length === 0) {
                    searchResults.style.display = 'block';
                    const noResults = document.createElement('div');
                    noResults.className = 'recommendation-item no-results';
                    noResults.innerHTML = `
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="recommendation-content">
                            <div class="recommendation-name">No locations found</div>
                            <div class="recommendation-location">Try adjusting your search or filters</div>
                        </div>
                    `;
                    searchResults.appendChild(noResults);
                    return;
                }
                
                // Separate into categories and subcategories
                const boysMesses = results.filter(loc => loc.type === 'mess' && loc.subtype === 'boys');
                const girlsMesses = results.filter(loc => loc.type === 'mess' && loc.subtype === 'girls');
                const normalCanteens = results.filter(loc => loc.type === 'canteen' && loc.subtype === 'normal');
                const nightCanteens = results.filter(loc => loc.type === 'canteen' && loc.subtype === 'night');
                
                let itemIndex = 0;
                
                // Add total count header
                const totalHeader = document.createElement('div');
                totalHeader.className = 'total-results-header';
                totalHeader.innerHTML = `
                    <i class="fas fa-list"></i>
                    <span>Found ${results.length} location${results.length !== 1 ? 's' : ''}</span>
                `;
                totalHeader.style.setProperty('--index', itemIndex++);
                searchResults.appendChild(totalHeader);
                
                // Add Boys Messes category
                if (boysMesses.length > 0) {
                    const boysHeader = document.createElement('div');
                    boysHeader.className = 'category-header boys-mess';
                    boysHeader.innerHTML = `
                        <i class="fas fa-male"></i> 
                        BOYS MESSES (${boysMesses.length})
                    `;
                    boysHeader.style.setProperty('--index', itemIndex++);
                    searchResults.appendChild(boysHeader);
                    
                    boysMesses.forEach(location => {
                        const item = createLocationItem(location);
                        item.style.setProperty('--index', itemIndex++);
                        searchResults.appendChild(item);
                    });
                }
                
                // Add Girls Messes category
                if (girlsMesses.length > 0) {
                    const girlsHeader = document.createElement('div');
                    girlsHeader.className = 'category-header girls-mess';
                    girlsHeader.innerHTML = `
                        <i class="fas fa-female"></i> 
                        GIRLS MESSES (${girlsMesses.length})
                    `;
                    girlsHeader.style.setProperty('--index', itemIndex++);
                    searchResults.appendChild(girlsHeader);
                    
                    girlsMesses.forEach(location => {
                        const item = createLocationItem(location);
                        item.style.setProperty('--index', itemIndex++);
                        searchResults.appendChild(item);
                    });
                }
                
                // Add Normal Canteens category
                if (normalCanteens.length > 0) {
                    const normalCanteenHeader = document.createElement('div');
                    normalCanteenHeader.className = 'category-header canteen-category';
                    normalCanteenHeader.innerHTML = `
                        <i class="fas fa-coffee"></i> 
                        NORMAL CANTEENS (${normalCanteens.length})
                    `;
                    normalCanteenHeader.style.setProperty('--index', itemIndex++);
                    searchResults.appendChild(normalCanteenHeader);
                    
                    normalCanteens.forEach(location => {
                        const item = createLocationItem(location);
                        item.style.setProperty('--index', itemIndex++);
                        searchResults.appendChild(item);
                    });
                }
                
                // Add Night Canteens category
                if (nightCanteens.length > 0) {
                    const nightCanteenHeader = document.createElement('div');
                    nightCanteenHeader.className = 'category-header night-canteen-category';
                    nightCanteenHeader.innerHTML = `
                        <i class="fas fa-moon"></i> 
                        NIGHT CANTEENS (${nightCanteens.length})
                    `;
                    nightCanteenHeader.style.setProperty('--index', itemIndex++);
                    searchResults.appendChild(nightCanteenHeader);
                    
                    nightCanteens.forEach(location => {
                        const item = createLocationItem(location);
                        item.style.setProperty('--index', itemIndex++);
                        searchResults.appendChild(item);
                    });
                }
                
                searchResults.style.display = 'block';
                // Add small delay for smooth animation
                setTimeout(() => {
                    searchResults.classList.add('show');
                }, 10);
                
                // Position the search results properly
                positionSearchResults();
            } catch (error) {
                console.error('Error displaying search results:', error);
                showNotification('Error displaying results. Please try again.', 'error');
            }
        }

        // Create location item for search results
        function createLocationItem(location) {
            try {
                const item = document.createElement('div');
                item.className = 'recommendation-item';
                item.dataset.id = location.id;
                
                let icon = 'fa-utensils';
                let typeBadge = 'Mess';
                let badgeClass = '';
                let statusText = '';
                let statusClass = '';
                
                if (location.type === 'canteen') {
                    icon = 'fa-coffee';
                    typeBadge = location.subtype === 'night' ? 'Night Canteen' : 'Canteen';
                    badgeClass = location.subtype === 'night' ? 'night-canteen' : 'canteen';
                    statusText = 'Open Now';
                    statusClass = 'status-open';
                } else {
                    // For messes, get current status
                    const currentMeal = getCurrentMeal(location);
                    if (!currentMeal) {
                        statusText = 'Closed';
                        statusClass = 'status-closed';
                    } else if (currentMeal.status === 'active') {
                        statusText = 'Open Now';
                        statusClass = 'status-open';
                    } else {
                        statusText = `Upcoming at ${currentMeal.start}`;
                        statusClass = 'status-upcoming';
                    }
                    
                    // Set badge class based on subtype
                    if (location.subtype === 'boys') {
                        badgeClass = 'boys-mess';
                    } else if (location.subtype === 'girls') {
                        badgeClass = 'girls-mess';
                    }
                }
                
                item.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <div class="recommendation-content">
                        <div class="recommendation-name">
                            ${location.name}
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="recommendation-location">${location.location}</div>
                        
                    </div>
                `;
                
                // Add click event to select location
                item.addEventListener('click', () => {
                    selectLocation(location);
                    if (searchResults) {
                        searchResults.classList.remove('show');
                        setTimeout(() => {
                            if (searchResults && !searchResults.classList.contains('show')) {
                                searchResults.style.display = 'none';
                            }
                        }, 300);
                    }
                });
                
                return item;
            } catch (error) {
                console.error('Error creating location item:', error);
                const errorItem = document.createElement('div');
                errorItem.className = 'recommendation-item';
                errorItem.innerHTML = '<i class="fas fa-exclamation-circle"></i><div class="recommendation-content">Error loading item</div>';
                return errorItem;
            }
        }

        // Select a location to view details
        function selectLocation(location) {
            try {
                selectedLocation = location;
                
                // Update UI
                if (locationName) locationName.textContent = location.name;
                if (locationDetails) locationDetails.textContent = `${location.location} â€¢ ${location.type === 'mess' ? 'Open until 8:45 PM' : 'Open all day'}`;
                
                // Set location icon
                if (locationIcon) {
                    if (location.type === 'canteen') {
                        locationIcon.className = location.subtype === 'night' ? 'fas fa-moon' : 'fas fa-coffee';
                    } else {
                        locationIcon.className = 'fas fa-utensils';
                    }
                }
                
                // Show current meal display
                if (currentDisplay) currentDisplay.style.display = 'block';
                if (fullMenuSection) fullMenuSection.style.display = 'none';
                
                // Show/hide view full schedule button based on location type
                if (viewFullBtn) {
                    if (location.type === 'mess') {
                        viewFullBtn.style.display = 'inline-flex';
                    } else {
                        viewFullBtn.style.display = 'none';
                    }
                }
                
                // Display appropriate content based on location type
                if (location.type === 'mess') {
                    displayMessDetails(location);
                } else {
                    displayCanteenDetails(location);
                }
            } catch (error) {
                console.error('Error selecting location:', error);
                showNotification('Error loading location details. Please try again.', 'error');
            }
        }

        // Display mess details
function displayMessDetails(mess) {
    try {
        // Set meal icon
        if (mealIcon) mealIcon.className = 'fas fa-utensils';
        
        // Get current meal information from weekly schedule
        const currentMeal = getCurrentMealFromSchedule(mess);
        
        if (!currentMeal) {
            // If mess is completely closed for today
            if (mealStatus) {
                mealStatus.textContent = 'Closed for the day';
                mealStatus.className = 'meal-status closed';
            }
            if (currentTimeTitle) currentTimeTitle.textContent = 'Next Available Meal';
            
            // Find next meal from schedule (could be tomorrow)
            const nextMeal = getNextMealFromSchedule(mess);
            if (nextMeal) {
                if (mealStatus) {
                    const dayText = nextMeal.day === new Date().toLocaleDateString('en-US', { weekday: 'long' }) ? 
                        '' : ` (${nextMeal.day})`;
                    mealStatus.textContent = `${nextMeal.name}${dayText}: ${formatTimeRange(nextMeal.start, nextMeal.end)}`;
                    mealStatus.className = 'meal-status upcoming';
                }
                
                // Display next meal items with better styling
                displayUpcomingMealItems(nextMeal.menu, nextMeal.name, nextMeal.day);
                
                // Start countdown to next meal
                startCountdownToNextDay(nextMeal.start, nextMeal.day);
                
                // Update countdown text
                const countdownText = document.getElementById('countdown-text');
                if (countdownText) {
                    const dayText = nextMeal.day === new Date().toLocaleDateString('en-US', { weekday: 'long' }) ? 
                        '' : ` (${nextMeal.day})`;
                    countdownText.textContent = `Next meal${dayText} in:`;
                }
            } else {
                if (mealStatus) {
                    mealStatus.textContent = 'Schedule unavailable';
                    mealStatus.className = 'meal-status closed';
                }
                if (currentMealItems) {
                    displayClosedMessMessage();
                }
                clearCountdown();
            }
        } else {
            // Update UI for current meal
            if (currentTimeTitle) {
                currentTimeTitle.textContent = currentMeal.status === 'active' ? 'Current Meal' : 'Upcoming Meal';
            }
            
            if (mealStatus) {
                mealStatus.textContent = `${currentMeal.name}: ${formatTimeRange(currentMeal.start, currentMeal.end)}`;
                mealStatus.className = currentMeal.status === 'active' ? 
                    'meal-status' : 'meal-status upcoming';
            }
            
            // Display meal items
            displayMealItems(currentMeal.menu);
            
            // Start countdown to meal end or next meal
            if (currentMeal.status === 'active') {
                startCountdown(currentMeal.end);
                const countdownText = document.getElementById('countdown-text');
                if (countdownText) {
                    countdownText.textContent = `Current meal ends in:`;
                }
            } else {
                startCountdown(currentMeal.start);
                const countdownText = document.getElementById('countdown-text');
                if (countdownText) {
                    countdownText.textContent = `Next meal starts in:`;
                }
            }
        }
    } catch (error) {
        console.error('Error displaying mess details:', error);
        showNotification('Error loading mess details. Please try again.', 'error');
    }
}
function startCountdownToNextDay(targetTime, targetDay) {
    try {
        if (!targetTime || !targetDay) return;
        
        clearCountdown();
        
        countdownInterval = setInterval(() => {
            try {
                const now = new Date();
                const currentDay = now.toLocaleDateString('en-US', { weekday: 'long' });
                
                // Parse target time
                const [time, modifier] = targetTime.split(' ');
                let [hours1, minutes1] = time.split(':').map(Number);
                
                // Convert to 24-hour format
                if (modifier === 'PM' && hours < 12) hours += 12;
                if (modifier === 'AM' && hours === 12) hours = 0;
                
                // Create target date
                const target = new Date();
                target.setHours(hours, minutes, 0, 0);
                
                // If target is for a different day, adjust the date
                if (targetDay !== currentDay) {
                    const daysOrder = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                    const currentDayIndex = daysOrder.indexOf(currentDay);
                    const targetDayIndex = daysOrder.indexOf(targetDay);
                    
                    let dayDifference = targetDayIndex - currentDayIndex;
                    if (dayDifference <= 0) {
                        dayDifference += 7; // Next week
                    }
                    
                    target.setDate(target.getDate() + dayDifference);
                }
                
                // If target time is already passed today and it's the same day, add 24 hours
                if (targetDay === currentDay && target <= now) {
                    target.setDate(target.getDate() + 1);
                }
                
                // Calculate time difference
                const diff = target - now;
                
                if (diff <= 0) {
                    // Time has passed, refresh the display
                    if (selectedLocation && selectedLocation.type === 'mess') {
                        displayMessDetails(selectedLocation);
                    }
                    return;
                }
                
                // Convert to days, hours and minutes
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                // Update countdown display
                if (countdownTimer) {
                    if (days > 0) {
                        countdownTimer.textContent = `${days}d ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                    } else {
                        countdownTimer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                    }
                }
                
            } catch (error) {
                console.error('Error updating countdown:', error);
                clearCountdown();
            }
        }, 1000);
    } catch (error) {
        console.error('Error starting countdown:', error);
        clearCountdown();
    }
}


        // Display canteen details
        function displayCanteenDetails(canteen) {
            try {
                // Set icons
                if (mealIcon) mealIcon.className = 'fas fa-utensils';
                
                // Update UI for canteens
                if (currentTimeTitle) currentTimeTitle.textContent = 'Available Menu';
                if (mealStatus) {
                    mealStatus.textContent = 'Full Menu Available';
                    mealStatus.className = 'meal-status';
                }
                
                // Display full canteen menu with better styling
                displayCanteenMenu(canteen.menu, canteen.name);
                
                // No countdown for canteens
                clearCountdown();
                if (countdownTimer) countdownTimer.textContent = '--:--';
                const countdownText = document.getElementById('countdown-text');
                if (countdownText) {
                    countdownText.textContent = 'Menu items available';
                }
            } catch (error) {
                console.error('Error displaying canteen details:', error);
                showNotification('Error loading canteen details. Please try again.', 'error');
            }
        }

        // Display meal items
        function displayMealItems(items) {
            try {
                if (!currentMealItems) return;
                
                currentMealItems.innerHTML = '';
                
                if (!items || items.length === 0) {
                    const item = document.createElement('div');
                    item.className = 'meal-item closed';
                    item.textContent = 'No menu available for this meal';
                    currentMealItems.appendChild(item);
                    return;
                }
                
                items.forEach(item => {
                    const mealItem = document.createElement('div');
                    mealItem.className = 'meal-item';
                    mealItem.innerHTML = `
                        <div class="meal-item-content">
                            <i class="fas fa-utensils"></i>
                            <span>${item}</span>
                        </div>
                    `;
                    currentMealItems.appendChild(mealItem);
                });
            } catch (error) {
                console.error('Error displaying meal items:', error);
                showNotification('Error loading meal items. Please try again.', 'error');
            }
        }
        
        // Display upcoming meal items with better styling
        function displayUpcomingMealItems(items, mealName, mealDay) {
    try {
        if (!currentMealItems) return;
        
        currentMealItems.innerHTML = '';
        
        // Add upcoming meal header
        const header = document.createElement('div');
        header.className = 'meal-item upcoming-header';
        
        const currentDay = new Date().toLocaleDateString('en-US', { weekday: 'long' });
        const dayText = mealDay === currentDay ? '' : ` (${mealDay})`;
        
        header.innerHTML = `
            <div class="upcoming-header-content">
                <i class="fas fa-clock"></i>
                <span>Upcoming ${mealName}${dayText} Menu</span>
            </div>
        `;
        currentMealItems.appendChild(header);
        
        if (!items || items.length === 0) {
            const item = document.createElement('div');
            item.className = 'meal-item closed';
            item.textContent = 'Menu details will be available soon';
            currentMealItems.appendChild(item);
            return;
        }
        
        items.forEach(item => {
            const mealItem = document.createElement('div');
            mealItem.className = 'meal-item upcoming';
            mealItem.innerHTML = `
                <div class="meal-item-content">
                    <i class="fas fa-utensils"></i>
                    <span>${item}</span>
                </div>
            `;
            currentMealItems.appendChild(mealItem);
        });
    } catch (error) {
        console.error('Error displaying upcoming meal items:', error);
        showNotification('Error loading upcoming meal items. Please try again.', 'error');
    }
}
        
        // Display closed mess message
        function displayClosedMessMessage() {
            try {
                if (!currentMealItems) return;
                
                currentMealItems.innerHTML = '';
                
                const closedMessage = document.createElement('div');
                closedMessage.className = 'meal-item closed-message';
                closedMessage.innerHTML = `
                    <div class="closed-message-content">
                        <i class="fas fa-door-closed"></i>
                        <div class="closed-text">
                            <h4>Mess is currently closed</h4>
                            <p>Check back later for the next meal schedule</p>
                        </div>
                    </div>
                `;
                currentMealItems.appendChild(closedMessage);
            } catch (error) {
                console.error('Error displaying closed mess message:', error);
            }
        }
        
        // Display canteen menu in a grid layout
        function displayCanteenMenu(menuItems, canteenName) {
            try {
                if (!currentMealItems) return;
                
                currentMealItems.innerHTML = '';

                if (!menuItems || Object.keys(menuItems).length === 0) {
                    const item = document.createElement('div');
                    item.className = 'meal-item closed';
                    item.textContent = 'Menu details will be available soon';
                    currentMealItems.appendChild(item);
                    return;
                }

                // Create menu grid container
                const menuGrid = document.createElement('div');
                menuGrid.className = 'canteen-menu-grid';
                
                // Process menu items by category
                for (const category in menuItems) {
                    if (menuItems.hasOwnProperty(category)) {
                        // Create category container
                        const categoryContainer = document.createElement('div');
                        categoryContainer.className = 'menu-category';
                        
                        // Create category title
                        const categoryTitle = document.createElement('div');
                        categoryTitle.className = 'category-title';
                        categoryTitle.innerHTML = `
                            <i class="fas fa-tag"></i>
                            <span>${category}</span>
                        `;
                        categoryContainer.appendChild(categoryTitle);
                        
                        // Create items container
                        const itemsContainer = document.createElement('div');
                        itemsContainer.className = 'menu-items';
                        
                        // Add items to category
                        menuItems[category].forEach(item => {
                            const menuItem = document.createElement('div');
                            menuItem.className = 'menu-item';
                            
                            // Handle both string and object formats
                            const itemName = typeof item === 'object' ? item.name : item;
                            const itemPrice = typeof item === 'object' ? item.price : 0;
                            
                            menuItem.innerHTML = `
                                <div class="menu-item-name">${itemName}</div>
                                <div class="menu-item-price">â‚¹${itemPrice}</div>
                            `;
                            itemsContainer.appendChild(menuItem);
                        });
                        
                        categoryContainer.appendChild(itemsContainer);
                        menuGrid.appendChild(categoryContainer);
                    }
                }
                
                currentMealItems.appendChild(menuGrid);
                
                // After all categories are added, equalize their heights
                setTimeout(() => {
                    equalizeGridHeights();
                    // Ensure proper grid alignment for fewer than 3 categories
                    const categoryCount = Object.keys(menuItems).length;
                    if (categoryCount < 3) {
                        const grid = document.querySelector('.canteen-menu-grid');
                        if (grid) {
                            if (categoryCount === 1) {
                                grid.style.justifyItems = 'center';
                            } else if (categoryCount === 2) {
                                grid.style.justifyItems = 'center';
                            }
                        }
                    }
                }, 100);

            } catch (error) {
                console.error('Error displaying canteen menu:', error);
                showNotification('Error loading canteen menu. Please try again.', 'error');
            }
        }

        // Position search results properly
        function positionSearchResults() {
            try {
                if (!searchResults || !searchInput) return;
                
                searchResults.style.visibility = 'visible';
                searchResults.style.opacity = '1';
                
            } catch (error) {
                console.error('Error positioning search results:', error);
            }
        }

        // Get current meal for a mess from weekly schedule
function getCurrentMealFromSchedule(mess) {
    try {
        if (!mess || !mess.weeklyMenu) return null;
        
        const now = new Date();
        const currentDay = now.toLocaleDateString('en-US', { weekday: 'long' });
        const currentTime = now.getHours() * 100 + now.getMinutes();
        
        // Get today's menu from weekly schedule
        const todayMenu = mess.weeklyMenu[currentDay];
        if (!todayMenu) return null;
        
        // Define meal order and timing
        const meals = [
            { name: 'Breakfast', start: '7:30 AM', end: '9:00 AM', menu: todayMenu.breakfast, key: 'breakfast' },
            { name: 'Lunch', start: '12:30 PM', end: '2:00 PM', menu: todayMenu.lunch, key: 'lunch' },
            { name: 'Snacks', start: '5:00 PM', end: '6:00 PM', menu: todayMenu.snacks, key: 'snacks' },
            { name: 'Dinner', start: '7:30 PM', end: '8:45 PM', menu: todayMenu.dinner, key: 'dinner' }
        ];
        
        // Function to convert time string to minutes for comparison
        function timeToMinutes(timeString) {
            const [time, modifier] = timeString.split(' ');
            let [hours, minutes] = time.split(':').map(Number);
            
            if (modifier === 'PM' && hours < 12) hours += 12;
            if (modifier === 'AM' && hours === 12) hours = 0;
            
            return hours * 100 + minutes;
        }
        
        // Find the current or upcoming meal
        for (const meal of meals) {
            if (!meal.menu || meal.menu.length === 0) continue;
            
            const startTotal = timeToMinutes(meal.start);
            const endTotal = timeToMinutes(meal.end);
            
            if (currentTime >= startTotal && currentTime <= endTotal) {
                return { ...meal, status: 'active' };
            } else if (currentTime < startTotal) {
                return { ...meal, status: 'upcoming' };
            }
        }
        
        return null;
    } catch (error) {
        console.error('Error getting current meal from schedule:', error);
        return null;
    }
}        
        // Get next meal for a mess from weekly schedule
function getNextMealFromSchedule(mess) {
    try {
        if (!mess || !mess.weeklyMenu) return null;
        
        const now = new Date();
        let currentDay = now.toLocaleDateString('en-US', { weekday: 'long' });
        const currentTime = now.getHours() * 100 + now.getMinutes();
        
        // Define meal order and timing
        const mealOrder = [
            { name: 'breakfast', displayName: 'Breakfast', start: '7:30 AM', end: '9:00 AM' },
            { name: 'lunch', displayName: 'Lunch', start: '12:30 PM', end: '2:00 PM' },
            { name: 'snacks', displayName: 'Snacks', start: '5:00 PM', end: '6:00 PM' },
            { name: 'dinner', displayName: 'Dinner', start: '7:30 PM', end: '8:45 PM' }
        ];
        
        // Days of the week in order
        const daysOrder = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        // Function to get next day
        function getNextDay(day) {
            const currentIndex = daysOrder.indexOf(day);
            return daysOrder[(currentIndex + 1) % 7];
        }
        
        // Function to convert time string to minutes for comparison
        function timeToMinutes(timeString) {
            const [time, modifier] = timeString.split(' ');
            let [hours, minutes] = time.split(':').map(Number);
            
            if (modifier === 'PM' && hours < 12) hours += 12;
            if (modifier === 'AM' && hours === 12) hours = 0;
            
            return hours * 100 + minutes;
        }
        
        // Check current day first
        let dayToCheck = currentDay;
        let isCurrentDay = true;
        
        for (let dayCount = 0; dayCount < 7; dayCount++) {
            const dayMenu = mess.weeklyMenu[dayToCheck];
            
            if (dayMenu) {
                // Find the next meal for this day
                for (const meal of mealOrder) {
                    if (!dayMenu[meal.name] || dayMenu[meal.name].length === 0) continue;
                    
                    const mealStartTime = timeToMinutes(meal.start);
                    
                    // If it's the current day, check if meal hasn't started yet
                    if (isCurrentDay) {
                        if (currentTime < mealStartTime) {
                            return {
                                name: meal.displayName,
                                start: meal.start,
                                end: meal.end,
                                menu: dayMenu[meal.name],
                                day: dayToCheck
                            };
                        }
                    } else {
                        // If it's a future day, return the first available meal
                        return {
                            name: meal.displayName,
                            start: meal.start,
                            end: meal.end,
                            menu: dayMenu[meal.name],
                            day: dayToCheck
                        };
                    }
                }
            }
            
            // Move to next day
            dayToCheck = getNextDay(dayToCheck);
            isCurrentDay = false;
        }
        
        return null;
    } catch (error) {
        console.error('Error getting next meal from schedule:', error);
        return null;
    }
}        
        // Get current meal for a mess
        function getCurrentMeal(mess) {
            try {
                if (!mess || !mess.timing) return null;
                
                const now = new Date();
                const currentTime = now.getHours() * 100 + now.getMinutes(); // Convert to HHMM format
                
                // Define meal order
                const meals = [
                    { name: 'Breakfast', ...mess.timing.breakfast },
                    { name: 'Lunch', ...mess.timing.lunch },
                    { name: 'Snacks', ...mess.timing.snacks },
                    { name: 'Dinner', ...mess.timing.dinner }
                ];
                
                // Find the current or upcoming meal
                for (const meal of meals) {
                    if (!meal.start || !meal.end) continue;
                    
                    const [startTime, startMod] = meal.start.split(' ');
                    const [endTime, endMod] = meal.end.split(' ');
                    
                    let startHours = parseInt(startTime.split(':')[0]);
                    let startMins = parseInt(startTime.split(':')[1]);
                    let endHours = parseInt(endTime.split(':')[0]);
                    let endMins = parseInt(endTime.split(':')[1]);
                    
                    // Convert to 24-hour format
                    if (startMod === 'PM' && startHours < 12) startHours += 12;
                    if (endMod === 'PM' && endHours < 12) endHours += 12;
                    if (startMod === 'AM' && startHours === 12) startHours = 0;
                    if (endMod === 'AM' && endHours === 12) endHours = 0;
                    
                    const startTotal = startHours * 100 + startMins;
                    const endTotal = endHours * 100 + endMins;
                    
                    if (currentTime >= startTotal && currentTime <= endTotal) {
                        return { ...meal, status: 'active' };
                    } else if (currentTime < startTotal) {
                        return { ...meal, status: 'upcoming' };
                    }
                }
                
                // If no meal found, mess is closed
                return null;
            } catch (error) {
                console.error('Error getting current meal:', error);
                return null;
            }
        }

        // Start countdown to a specific time
        function startCountdown(targetTime) {
            try {
                if (!targetTime) return;
                
                clearCountdown();
                
                countdownInterval = setInterval(() => {
                    try {
                        const now = new Date();
                        const [time, modifier] = targetTime.split(' ');
                        let [hours, minutes] = time.split(':').map(Number);
                        
                        // Convert to 24-hour format
                        if (modifier === 'PM' && hours < 12) hours += 12;
                        if (modifier === 'AM' && hours === 12) hours = 0;
                        
                        const target = new Date();
                        target.setHours(hours, minutes, 0, 0);
                        
                        // Calculate time difference
                        let diff = target - now;
                        if (diff < 0) {
                            // If time is already passed, add 24 hours
                            diff += 24 * 60 * 60 * 1000;
                        }
                        
                        // Convert to hours and minutes
                        const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
                        const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        
                        // Update countdown display
                        if (countdownTimer) {
                            countdownTimer.textContent = `${hoursLeft.toString().padStart(2, '0')}:${minutesLeft.toString().padStart(2, '0')}`;
                        }
                        
                        // Update text
                        const countdownText = document.getElementById('countdown-text');
                        if (countdownText) {
                            countdownText.textContent = 'Next meal in:';
                        }
                    } catch (error) {
                        console.error('Error updating countdown:', error);
                        clearCountdown();
                    }
                }, 1000);
            } catch (error) {
                console.error('Error starting countdown:', error);
                clearCountdown();
            }
        }

        // Clear countdown interval
        function clearCountdown() {
            try {
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                }
            } catch (error) {
                console.error('Error clearing countdown:', error);
                countdownInterval = null;
            }
        }

        // Show full schedule
        function showFullSchedule() {
            try {
                if (!selectedLocation || selectedLocation.type !== 'mess') return;
                
                if (fullMenuName) fullMenuName.textContent = selectedLocation.name;
                if (weeklySchedule) weeklySchedule.innerHTML = '';
                
                // Get current day
                const now = new Date();
                const currentDay = now.toLocaleDateString('en-US', { weekday: 'long' });
                
                // Create table rows for each day
                Object.entries(selectedLocation.weeklyMenu).forEach(([day, meals]) => {
                    const row = document.createElement('tr');
                    
                    // Highlight current day
                    if (day === currentDay) {
                        row.classList.add('current-day');
                    }
                    
                    // Day cell
                    const dayCell = document.createElement('td');
                    dayCell.textContent = day;
                    
                    // Meal cells
                    ['breakfast', 'lunch', 'snacks', 'dinner'].forEach(meal => {
                        const mealCell = document.createElement('td');
                        if (meals[meal]) {
                            mealCell.innerHTML = meals[meal].map(item => `<div>${item}</div>`).join('');
                            
                            // Highlight current meal if it's the current day
                            if (day === currentDay) {
                                const currentMeal = getCurrentMeal(selectedLocation);
                                if (currentMeal && currentMeal.name.toLowerCase() === meal) {
                                    mealCell.classList.add('current-meal');
                                }
                            }
                        } else {
                            mealCell.textContent = 'Closed';
                            mealCell.classList.add('closed');
                        }
                        row.appendChild(mealCell);
                    });
                    
                    if (weeklySchedule) weeklySchedule.appendChild(row);
                });
                
                // Show full menu section
                if (currentDisplay) currentDisplay.style.display = 'none';
                if (fullMenuSection) fullMenuSection.style.display = 'block';
            } catch (error) {
                console.error('Error showing full schedule:', error);
                showNotification('Error loading full schedule. Please try again.', 'error');
            }
        }

        // Hide full schedule
        function hideFullSchedule() {
            try {
                if (fullMenuSection) fullMenuSection.style.display = 'none';
                if (currentDisplay) currentDisplay.style.display = 'block';
            } catch (error) {
                console.error('Error hiding full schedule:', error);
                showNotification('Error hiding schedule. Please try again.', 'error');
            }
        }

        // Equalize heights of all grid items for symmetry
        function equalizeGridHeights() {
            try {
                const gridItems = document.querySelectorAll('.menu-category');
                if (gridItems.length === 0) return;
                
                // Reset heights to auto to get natural heights
                gridItems.forEach(item => {
                    item.style.height = 'auto';
                });
                
                // Find the tallest item
                let maxHeight = 0;
                gridItems.forEach(item => {
                    const height = item.offsetHeight;
                    if (height > maxHeight) {
                        maxHeight = height;
                    }
                });
                
                // Set all items to the same height
                if (maxHeight > 0) {
                    gridItems.forEach(item => {
                        item.style.height = maxHeight + 'px';
                    });
                }
            } catch (error) {
                console.error('Error equalizing grid heights:', error);
            }
        }
        
        // Show notification
        function showNotification(message, type = '') {
            try {
                console.log(`[${type.toUpperCase()}] ${message}`);
            } catch (error) {
                console.error('Error logging notification:', error);
            }
        }

        // Start live updates
        function startLiveUpdates() {
            // Update last updated time every minute
            setInterval(() => {
                if (globalLastUpdate) {
                    globalLastUpdate.textContent = formatTime(new Date());
                }
            }, 60000);
            
            // Update current meal status every 5 minutes
            setInterval(() => {
                if (selectedLocation && selectedLocation.type === 'mess') {
                    displayMessDetails(selectedLocation);
                }
            }, 300000);
        }

        // Helper functions
        function formatDate(date) {
            try {
                if (!date || !(date instanceof Date)) return 'Invalid Date';
                return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            } catch (error) {
                console.error('Error formatting date:', error);
                return 'Invalid Date';
            }
        }

        function formatTime(date) {
            try {
                if (!date || !(date instanceof Date)) return 'Invalid Time';
                return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            } catch (error) {
                console.error('Error formatting time:', error);
                return 'Invalid Time';
            }
        }

        function formatTimeRange(start, end) {
            try {
                if (!start || !end) return 'Invalid Time Range';
                return `${start} - ${end}`;
            } catch (error) {
                console.error('Error formatting time range:', error);
                return 'Invalid Time Range';
            }
        }

        // Load favorites (stub for completeness)
        function loadFavorites() {
            // Implementation if needed
        }

        // Check URL parameters for sidebar activation
        function checkSidebarActivation() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('sidebar') === 'active') {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.add('active');
                }
            }
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', () => {
            // Check for sidebar activation from URL
            checkSidebarActivation();

            // Hide Account section for unauthorized users
            const token = localStorage.getItem('token');
            if (!token) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    const titles = sidebar.querySelectorAll('.sidebar-title');
                    titles.forEach(title => {
                        if (title.textContent.trim().toLowerCase().includes('account')) {
                            const nextUl = title.nextElementSibling;
                            if (nextUl && nextUl.tagName === 'UL') {
                                nextUl.remove();
                            }
                            title.remove();
                        }
                    });
                }
            }

            if (!searchInput || !searchResults) {
                console.error('Required DOM elements not found. Mess menu system cannot initialize.');
                return;
            }

            try {
                createParticles();
                init();
            } catch (error) {
                console.error('Failed to initialize mess menu system:', error);
                showNotification('Failed to initialize mess menu system. Please refresh the page.', 'error');
            }
        });
        
    </script>
</body>
</html> 